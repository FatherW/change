<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-text-field/vaadin-number-field.html">
<dom-module id="change-control-pannel">

    <template>

        <style>
            * {
                color: black;
                font-family: sans-serif, Microsoft JhengHei;
            }

            .container {
                /* background-image: url(http://change.dazzle.website/img/background/3.jpg); */

            }

            #controlbar {
                padding-top: 15px;
                padding-bottom: 25px;
                background: white;
                width: 84%;
                margin: 0 auto;
                margin-top: 25px;
            }

            .cp {
                text-align: center;
            }

            .miscount {
                text-align: center;
                margin: 35px 0 50px 0;
            }

            button {
                cursor: pointer;
                font-family: sans-serif, Microsoft JhengHei;
                font-size: 15px;
                width: 17%;
                border-radius: 3px;
            }

            .buttons {
                margin: 0 auto;
                text-align: center;
            }

            .buttons button {
                height: 50px;
                font-family: sans-serif, Microsoft JhengHei;
                margin-right: 30px;
                border: 1px solid #ccc;
                color: white;
            }

            #add {
                background-color: orange;
            }

            #dq {
                background-color: red;
            }

            #recover {
                background-color: green;
            }

            #manage {
                background-color: blue;
            }

            @media only screen and (max-width: 992px) {}

            @media only screen and (max-width: 640px) {
                #controlbar {
                    display: none;
                    width: 100%;
                }

                .buttons button {
                    margin-right: 10px;
                }

                button {
                    width: 20%;
                }
            }
        </style>

        <div class="container">

            <div id="controlbar" style="display: none;">
                <div class="cp">
                    <span>!管理面板!</span>
                </div>
                <div class="miscount">
                    <span>專頁犯錯次數:</span>
                    <vaadin-number-field has-controls></vaadin-number-field>
                </div>

                <div class="buttons">
                    <button id="add" on-click="_addFanPage">新增專頁</button>
                    <button id="dq" on-click="_disqualify">取消資格</button>
                    <button id="recover" on-click="_recovery">回復資格</button>
                    <button id="manage" on-click="_manageFanPage">管理專頁</button>
                </div>
            </div>
        </div>
    </template>

</dom-module>

<script>
    (function () {
        Polymer({
            is: 'change-control-pannel',
            properties: {},


            created: function () { },

            ready: function () {
                let shadow = this.shadowRoot;
                let that = this;

                let usercookies = store.get('change-user');
                let userID = usercookies['id'];

                // console.log("cookie", userID);
                let link = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                let param = {
                    "action": "searchData",
                    "index": "change",
                    "type": "_user",
                    "body": {
                        "query": {
                            "match": {
                                "id": userID
                            }
                        }
                    }
                };
                Polymer.postData(link, param).then(res => {
                    if (res.code > 0) {
                        // console.log("CHECK",res.code);
                        let adminStatus = res.resolve[0].isAdmin;
                        if (Boolean(adminStatus) == true) {
                            console.log("This user is ADMIN!");
                            console.log("status", adminStatus);
                            shadow.querySelector("#controlbar").style.display = "block";

                        } else {
                            console.log("This user is NOT ADMIN!");
                        }
                    } else {
                        console.log("CANNOT SEARCH USER!");
                    }
                })
            },

            _addFanPage: function () {
                console.log("addFanPage is working!")
            },

            _disqualify: function () {
                console.log("disqualify is working!")
                loc = location.search;
                let uid = "";
                for (i = 1; i < loc.length; i++) {
                    uid += loc[i];
                }
                // console.log("uid", uid);
                let params = {
                    "action": "addData",
                    "index": "change",
                    "type": "_user",
                    "id": uid,
                    "body": {
                        "token": "1"
                    }
                };
                let Url = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                Polymer.postData(Url, params).then(res => {
                    if (res.code > 0) {
                        alert("取消了該用戶資格");
                    }
                })
            },

            _recovery: function () {
                console.log("recovery is working!")
                loc = location.search;
                let uid = "";
                for (i = 1; i < loc.length; i++) {
                    uid += loc[i];
                }
                // console.log("uid", uid);
                let params = {
                    "action": "addData",
                    "index": "change",
                    "type": "_user",
                    "id": uid,
                    "body": {
                        "token": ""
                    }
                };
                let Url = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                Polymer.postData(Url, params).then(res => {
                    if (res.code > 0) {
                        alert("回復了該用戶資格");
                    }
                })
            },

            _manageFanPage: function () {
                console.log("manageFanPage is working!")
            },
        });
    })();
</script>