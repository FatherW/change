<link href="../polymer/polymer.html" rel="import">
<link href="../dz-menu/css/style.html" rel="import" />
<dom-module id="change-user-banner">
    <template>
        <style include="icon-styles"></style>
        <style>
            * {
                font-family: sans-serif, Microsoft JhengHei;

            }

            #mp {
                padding-top: 17%;
                background-size: cover;
                background-position: center center;
                background-repeat: no-repeat;
                background-image: url('./Website Design/profile page/img/profile banner/company-profile-banner.png');
            }

            #offer {
                margin: 0 auto;
                width: 84%;
                display: flex;
                padding: 10px 0;
                height: auto;
                background-color: white;
            }

            .in {
                padding-right: 1%;
                padding-left: 1%;
                margin-left: 25px;
            }

            #dp {
                width: 70px;
                height: 70px;
                border-radius: 9999999999999px;
                margin: 18% 0%;
                padding-top: 0px;
            }

            #user {
                padding-top: 1%;
                width: 100%;
            }

            #Uname {
                font-size: 1.5em;
                font-weight: 800;
                color: black
            }

            #check {
                color: gray;
            }

            #buttonM {
                display: flex;
                margin-right: 25px;
            }

            .buttons {
                width: 80px;
                text-align: center;
            }

            h6 {
                margin: 10% 0%;
                font-size: 15px;
            }

            .ret {
                font-size: 3em;
                text-align: center;
                color: red;
            }


            @media only screen and (max-width: 768px) {
                .buttons {
                    width: 70px;
                }
            }


            @media only screen and (max-width: 640px) {
                #offer {
                    width: 100%;
                    margin-bottom: 10px;
                }

                .in {
                    padding-right: 0;
                    padding-left: 0;
                    margin-left: 0;
                }

                #dp {
                    width: 60px;
                    height: 60px;
                }

                #user {
                    margin-top: 10px;
                    margin-left: 10px;
                }

                #Uname {
                    font-size: 1.1em;
                }

                #buttonM {
                    margin-right: 0;
                }

                .buttons {
                    width: 60px;
                    margin-top: 5px;
                }

                .ret {
                    font-size: 2em;
                }
            }
        </style>

        <div id="mp"></div>
        <div id="offer">
            <div class="in">
                <img id="dp" src="img/symbol/s5.png" alt="DP" />
            </div>
            <div id="user" class="in">
                <span id="Uname"></span>
                <br />
                <span id="check"> 註冊日期:</span>
            </div>
            <div id="buttonM">
                <div class="in buttons">
                    <h6>上貨數</h6>
                    <span class="ret" id="gNum"></span>
                </div>
                <div class="in buttons">
                    <h6>購買數</h6>
                    <span class="ret" id="buy"></span>
                </div>
                <div class="in buttons" id="threeWords">
                    <h6>平均評分</h6>
                    <span class="ret" id="rate"></span>
                </div>
            </div>

        </div>

    </template>
</dom-module>
<script>
    (function() {
        Polymer({
            is: 'change-user-banner',
            properties: {

            },
            created: function() {

            },
            ready: function() {
                let loc = location.search;
                let id = "";
                for (var i = 1; i < loc.length; i++) {
                    id += loc[i];
                }
                if (id != "") {
                    let shadow = this.shadowRoot;
                    let url = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                    let params = {
                        "action": "searchData",
                        "index": "change",
                        "type": "_user",
                        "body": {
                            "query": {
                                "match": {
                                    "_id": id
                                }
                            }
                        }
                    };
                    Polymer.postData(url, params).then(res => {
                        if (res.code > 0) {
                            if (res.resolve.length > 0) {
                                shadow.querySelector('#Uname').innerText = res.resolve[0]['username'];
                                let t = res.resolve[0]['createTime'];
                                let _thetimenow = Date.now();
                                let comparetime = (_thetimenow - t) / 1000;
                                if (comparetime < 60) {
                                    shadow.querySelector('#check').innerHTML += "剛剛"
                                } else if (comparetime / 60 < 60) {
                                    shadow.querySelector('#check').innerHTML += Math.floor(comparetime / 60) + "分鐘前"
                                } else if (comparetime / 60 / 60 < 24) {
                                    shadow.querySelector('#check').innerHTML += Math.floor(comparetime / 60 / 60) + "小時前"
                                } else if (comparetime / 60 / 60 / 24 < 7) {
                                    shadow.querySelector('#check').innerHTML += Math.floor(comparetime / 60 / 60 / 24) + "日前"
                                } else if (comparetime / 60 / 60 / 24 / 7 < 30) {
                                    shadow.querySelector('#check').innerHTML += Math.floor(comparetime / 60 / 60 / 24 / 7) + "星期前"
                                } else if (comparetime / 60 / 60 / 24 / 7 / 30 < 365) {
                                    shadow.querySelector('#check').innerHTML += Math.floor(comparetime / 60 / 60 / 24 / 7 / 30) + "月前"
                                }
                                shadow.querySelector('#gNum').innerText = res.resolve[0]['goodsNum'];
                                shadow.querySelector('#buy').innerText = res.resolve[0]['history'].length;
                                shadow.querySelector('#rate').innerText = res.resolve[0]['score'];
                                if (res.resolve[0]['head'] == "") {
                                    shadow.querySelector('#dp').src = "./img/head.svg";
                                } else {
                                    shadow.querySelector('#dp').src = res.resolve[0]['head'];
                                }
                            }
                        }
                    })
                } else {
                    let user = store.get("change-user") || null;
                    if (user != null) {
                        let shadow = this.shadowRoot;
                        shadow.querySelector('#Uname').innerText = user['username'];
                        let t = res.resolve[0]['createTime'];
                        let _thetimenow = Date.now();
                        let comparetime = (_thetimenow - t) / 1000;
                        if (comparetime < 60) {
                            shadow.querySelector('#check').innerHTML = "剛剛"
                        } else if (comparetime / 60 < 60) {
                            shadow.querySelector('#check').innerHTML = Math.floor(comparetime / 60) + "分鐘前"
                        } else if (comparetime / 60 / 60 < 24) {
                            shadow.querySelector('#check').innerHTML = Math.floor(comparetime / 60 / 60) + "小時前"
                        } else if (comparetime / 60 / 60 / 24 < 7) {
                            shadow.querySelector('#check').innerHTML = Math.floor(comparetime / 60 / 60 / 24) + "日前"
                        } else if (comparetime / 60 / 60 / 24 / 7 < 30) {
                            shadow.querySelector('#check').innerHTML = Math.floor(comparetime / 60 / 60 / 24 / 7) + "星期前"
                        } else if (comparetime / 60 / 60 / 24 / 7 / 30 < 365) {
                            shadow.querySelector('#check').innerHTML = Math.floor(comparetime / 60 / 60 / 24 / 7 / 30) + "月前"
                        }
                        shadow.querySelector('#gNum').innerText = user['goodsNum'];
                        shadow.querySelector('#buy').innerText = user['alreadyBuy'];
                        shadow.querySelector('#rate').innerText = user['score'];
                        shadow.querySelector('#dp').src = res.resolve['head'];
                    } else {
                        alert('沒有此用戶 請先登入');
                    }
                }
            },


        });
    })();
</script>