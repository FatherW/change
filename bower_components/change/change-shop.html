<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../dz-dazzle/dz-block.html">
<link rel="import" href="../change/change-in-item.html?sd3234">
<link rel="import" href="change-like2.html">
<link rel="import" href="../change/change-slidelist.html?sdkflsa">
<link rel="import" href="../vaadin-accordion/vaadin-accordion.html">
<link rel="import" href="../paper-tags-input/paper-tags-input.html">

<dom-module id="change-shop">

    <template>

        <style>
            *{
                font-family: sans-serif,微軟正黑體;
                            }
                            .clear{
                                clear:both;
                            }
            change-in-item{
                -webkit-box-shadow: 1px 0px 8px 0px rgba(50, 49, 56, 0.2);
                -moz-box-shadow: 1px 0px 8px 0px rgba(50, 49, 56, 0.2);
                box-shadow: 1px 0px 8px 0px rgba(50, 49, 56, 0.2);
            }
            .catbutton{
                background-color: lightgrey;
                text-align: center;
                padding-left: 13px;
                padding-right: 13px;
                border: none;
                width: auto;
                height: 30px;
                border-radius: 15px;

            }
            a:link,
            a:visited {
                text-decoration: none;
                color: black;
            }

            a:hover {
                text-decoration: none;

            }
            #miniimg{
                width:30px;
                height:30px;
            }
            .shouldblock2{
                display: inline;
            }
            .leftele{
                float: left;
                color: black;
                margin-left: 8px;
                border:none
            }
            .leftele2{
                float:left;
                border: none;
         
                
            } 
            .rightele{
                float: left;
            }
            .rightele2{
                float:right;
            }
            .shouldblock{
                display: flow-root;
            }

            #leftele{
                float: left;
                width: 20%;
                min-width: 150px;
                margin-top: 50px;
                margin-right:30px;
            }

            #rightele{
                width:70%;

            }


            body{
                background-color: wheat;
            }
             #containall{
                background-color: wheat;
                width: 100%;
            }

            .valuebar1 {
                padding-top: 8px;
                padding-left: 15px;
                text-align: left;
                width: 50%;
                font-size: 9px;
                height:30px
            }
            
            .valuebar2 {
                padding-top: 8px;
                padding-right: 15px;
                text-align: right;
                width: 50%;
                font-size: 9px;
                height:30px
            }
            
            .slidebar1 {
                padding-top: 8px;
                padding-bottom: 15px;
                height:50px;
            }
            
            #cong {
                background-color: white;
                font-size: larger;
            }
            
            .largebar {
                width: 50px;
                height: 70px;
            }
            
            .table1 {
                width: 100%;
                min-width: 200px;
                box-sizing: 1px 10px;
                background-color: white;
                box-shadow: gray;
                margin-bottom: 30px;
                -webkit-box-shadow: 1px 0px 8px 0px rgba(50, 49, 56, 0.2);
                -moz-box-shadow: 1px 0px 8px 0px rgba(50, 49, 56, 0.2);
                box-shadow: 1px 0px 8px 0px rgba(50, 49, 56, 0.2);

            }
            
            td {
                padding-left: 25px;
                font-size: 13px;
            }
            
            .titlecolor {
                background-color: #F0846C;
                color: white;
                text-align: center;
                width: 100%;
                min-width: 200px;
                font-size: 12px;
                height:50px;
                border: none;
            }
            
            .tags {
                width: 100px;
                border: none;
                padding: 5px;
                font-size: 9px;
                height:50px;
            }

            #isnew1,
            #isnew2{
                height:40px;
            }

            
            
            .box {
                text-align: right;
                padding-right: 7px;
                height:40px;
            }
            
            #loc {
                height:50px;
                width: 100px;
                border: white;
                text-align: right;
                padding-right: 7px;
                font-size: 13px;
            }
            
            .mybutton {
                box-shadow:inset 0px 0px 10px 1px #cf866c;
                background-color:#d0451b;
                border-radius:16px;
                border:2px solid #942911;
                display:inline-block;
                align-items: center;
                cursor:pointer;
                color:#ffffff;
                font-family:Arial;
                margin-left: 100px;
                font-size:12px;
                padding:7px 30px;
                margin-top: 5px;
                text-decoration:none;
                text-shadow:0px 0px 0px #854629;
            }
            .mybutton:hover {
                background-color:#bc3315;
            }
            .mybutton:active {
                position:relative;
                top:1px;
                border: white;
            }

            .hidetb{
                float:right;
                background-image: url("http://change.dazzle.website/img/button_bg.svg");
                width:30px;
                height:30px;
                border: none;
                background-color: transparent;
            }



            .hidetb:active{
               outline: none;
            }

            .showtb{
                display: block;
            }
            
            /* .hiddentb{
                display: none;
            } */
           
            #loc2 {
                padding: 5px;
                text-align: center;
                
            }
            
            .inlist {
                font-size: 9px;
                text-align: center;
                margin:6px
            }
            
            .container {
                width: 90%;
            }
            
            .slider-labels {
                margin-top: 10px;
            }
            
            .noUi-target,
            .noUi-target * {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -ms-touch-action: none;
                touch-action: none;
                -ms-user-select: none;
                -moz-user-select: none;
                user-select: none;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
            }
            
            .noUi-target {
                position: relative;
                direction: ltr;
            }
            
            .noUi-base {
                width: 100%;
                height: 100%;
                position: relative;
                z-index: 1;
                /* Fix 401 */
            }
            
            .noUi-origin {
                position: absolute;
                right: 0;
                top: 0;
                left: 0;
                bottom: 0;
            }
            
            .noUi-handle {
                position: relative;
                z-index: 1;
            }
            
            .noUi-stacking .noUi-handle {
                /* This class is applied to the lower origin when
its values is > 50%. */
                z-index: 10;
            }
            
            .noUi-state-tap .noUi-origin {
                -webkit-transition: left 0.3s, top .3s;
                transition: left 0.3s, top .3s;
            }
            
            .noUi-state-drag * {
                cursor: inherit !important;
            }
            /* Painting and performance;
* Browsers can paint handles in their own layer.
*/
            
            .noUi-base,
            .noUi-handle {
                -webkit-transform: translate3d(0, 0, 0);
                transform: translate3d(0, 0, 0);
            }
            /* Slider size and handle placement;
*/
            
            .noUi-horizontal {
                height: 4px;
            }
            
            .noUi-horizontal .noUi-handle {
                width: 13px;
                height: 13px;
                border-radius: 50%;
                left: -7px;
                top: -4px;
                background-color: #F0846C;
            }
            /* Styling;
*/
            
            .noUi-background {
                background: #D6D7D9;
            }
            
            .noUi-connect {
                background: #F0846C;
                -webkit-transition: background 450ms;
                transition: background 450ms;
            }
            
            .noUi-origin {
                border-radius: 2px;
            }
            
            .noUi-target {
                border-radius: 2px;
            }
            
            /* .noUi-target.noUi-connect {}
            /* Handles and cursors;
*/
             */
            .noUi-draggable {
                cursor: w-resize;
            }
            
            .noUi-vertical .noUi-draggable {
                cursor: n-resize;
            }
            
            .noUi-handle {
                cursor: default;
                -webkit-box-sizing: content-box !important;
                -moz-box-sizing: content-box !important;
                box-sizing: content-box !important;
            }
            
            .noUi-handle:active {
                border: 8px solid #F0846C;
                border: 3px solid grey;
                -webkit-background-clip: padding-box;
                background-clip: padding-box;
                left: -9px;
                top: -7px;
            }
            /* Disabled state;
*/
            
            [disabled].noUi-connect,
            [disabled] .noUi-connect {
                background: #B8B8B8;
            }
            
            [disabled].noUi-origin,
            [disabled] .noUi-handle {
                cursor: not-allowed;
            }

            #toptitle{
                font-size:25px;
                /* margin-left: 10px; */
                font-weight:900;
            }

            body{
                margin:none;
            }

      


        </style>

    <div id="containall">
        <div id="leftele">
                <change-slidelist></change-slidelist>
        </div>
      
        <div id="rightele" style="float:left; margin-top:50px;border:'none'; ">
            <div class="initemtitle" id="viewingcat">你正在瀏覽的分類  </div>
            <paper-tags-input width="100%" id="myTags"></paper-tags-input>
            <change-in-item></change-in-item>
        </div>
    </div>
    <slot></slot>


    </template>


    <script>
        (function() {
            Polymer({
                is: 'change-shop',
                properties: {
                    'category': {
                        "type": Array
                    },
                    'searchTags': {
                        "type": Array
                    },
                    'priceStart': {
                        "type": Number
                    },
                    'priceStop': {
                        'type': Number
                    },
                    'initprice': {
                        'type': Number
                    }
                },
                created: function() {
                    let that = this;
                    this.categories = [];
                    this.tags = [];
                    this.priceStart = 0;
                    this.priceStop = 1000000;
                    this.district = null;
                    this.isNew = [];
                    this.initprice = 0;
                },
                addTags(val) {
                    let myTags = this.shadowRoot.querySelector('#myTags');
                    // let val = this.shadowRoot.querySelector('#inputTags').value;
                    myTags._addTag(val);
                },
                search() {
                    // search(cats,tags,district,priceStart,priceEnd){
                    this.shadowRoot.querySelector('change-in-item').search(this.categories, this.tags, this.district, this.isNew, this.priceStart, this.priceStop);
                },
                back(value) {
                    let posit = 99999;
                    ////categories
                    for (i = 0; i < this.categories.length; i++) {
                        if (this.categories[i] == value) {
                            posit = i;
                            this.categories.splice(posit, 1);
                            break
                        }
                    }
                    ////tags
                    for (i = 0; i < this.tags.length; i++) {
                        if (this.tags[i] == value) {
                            posit = i;
                            this.tags.splice(posit, 1);
                            break
                        }
                    }


                    ////isNew
                    for (i = 0; i < this.isNew.length; i++) {
                        if (this.isNew[i] == value) {
                            posit = i;
                            this.isNew.splice(posit, 1);
                            var statnew1 = this.shadowRoot.querySelector('change-slidelist').shadowRoot.querySelector('#isnew1').checked;
                            var statnew2 = this.shadowRoot.querySelector('change-slidelist').shadowRoot.querySelector('#isnew2').checked;

                            if (value = "全新") {

                                if (statnew1 == true) {

                                    statnew1 = boolean(false);

                                }
                            } else {
                                if (statnew2 == true) {
                                    statnew2 = boolean(false);
                                }
                            }
                            break
                        }
                    }
                    ////district
                    if (this.district == value) {
                        this.district = null;
                    }
                    this.search();
                    ///range
                    let msgrange = "$" + this.priceStart + " - $" + this.priceStop;
                    if (msgrange == value) {
                        this.priceStart = 0;
                        this.priceStop = this.initprice;
                    }


                },
                ready: function() {
                    let value;
                    document.addEventListener('query-tags', e => {
                        value = e.detail.tags;
                        this.addTags(value);
                        this.tags.push(value);
                        this.search();

                    });
                    document.addEventListener('query-isNew', e => {
                        let isNew = e.detail.isNew;
                        if (isNew == "全新") {
                            isnew = true;

                        } else {
                            isnew = false;
                        }
                        this.addTags(isNew);
                        this.isNew.push(isNew);
                        this.search();

                    });
                    document.addEventListener('select-category', e => {
                        let category = e.detail.category;
                        this.addTags(category);
                        this.categories.push(category);
                        this.search();
                    });
                    document.addEventListener('select-district', e => {
                        // let category = e.detail.category;
                        this.addTags(e.detail.district);
                        // this.tags.push(e.detail.district);
                        this.district = e.detail.district;
                        this.search();
                    });
                    document.addEventListener('select-range', e => {
                        let minprice = e.detail.start;
                        let maxprice = e.detail.end;
                        var storeminprice = [];
                        var storemaxprice = [];
                        var storeminposit = [];
                        var storemaxposit = [];
                        ////from($xx,xxx) to ($xxxxx)
                        for (countminprice = 0; countminprice < minprice.length; countminprice++) {
                            if (minprice[countminprice] != ',') {
                                storeminprice.push(minprice[countminprice]);
                            }

                        }
                        for (countmaxprice = 0; countmaxprice < maxprice.length; countmaxprice++) {
                            if (maxprice[countmaxprice] != ",") {
                                storemaxprice.push(maxprice[countmaxprice]);
                            }
                        }

                        this.priceStart = parseInt(storeminprice.join("").toString());
                        this.priceStop = parseInt(storemaxprice.join("").toString());
                        let msgrange = "$" + this.priceStart + " - $" + this.priceStop;
                        this.addTags(msgrange);
                        this.search();


                    })
                }
            })
        }());
    </script>
</dom-module>