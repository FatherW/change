<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/polymer/polymer.html">
<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-text-field/vaadin-email-field.html">
<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-text-field/vaadin-password-field.html">
<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-text-field/vaadin-number-field.html">
<link href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/dz-menu/css/style.html" rel="import" />
<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-button/vaadin-button.html">

<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/vaadin-dialog/vaadin-dialog.html">

<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/change/change-dropzone-file.html">


<link rel="import" href="./change-buy.html">
<link rel="import" href="./change-webcom.html">
<link rel="import" href="./change-picslide.html">
<link rel="import" href="./change-orderlist-storage.html">
<link rel="import" href="./change-order-list.html">

<link rel="import" href="change-edit-bar.html">
<link rel="import" href="change-user-tag.html">

<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.4.2/jquery.fancybox.min.css">
<script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.4.2/jquery.fancybox.min.js"></script>


<dom-module id="change-new-product">

    <template>
        <style include="icon-styles"></style>
        <style>
            * {
                color: black;
                font-family: sans-serif, Microsoft JhengHei;
            }

            vaadin-dialog[part="content"] {
                padding: 0px;
                overflow: hidden;
            }

            hr {
                max-width: 100px;
                margin-left: 0;
                margin-bottom: 10px;
            }

            ul {
                display: flex;
                margin-bottom: 0px;
            }

            li {
                list-style: none;
            }

            .top-banner {
                margin-right: 1%;
                background: #FFE9BF;
                background-repeat: no-repeat;
                background-size: contain;
                
            }

            #banner3 {
                width: 100%;
                height: auto;
                display: block;
            }

            .change-new-product-container {
                display: grid;
                grid-template-columns: 1fr 0.8fr;
                height: auto;
                margin: 0 auto;
                background: white;
                width: 92.5%;
                border: solid 1px #ccc;
            }

            button {
                cursor: pointer;
            }

            .buttons button {
                padding: 3px;
                margin-top: 20px;
            }

            #upload {
                border-radius: 0;
                padding: 8px;
                float: right;
                margin-top: 30px;
                min-block-size: fit-content;
                border: 1px solid #ccc;
                width: 22%;
                height: 40px;
                background-color: white;
            }

            .u {
                margin-right: 0;
            }

            .outer {
                margin: 0;
                width: 100%;
                background-image: url("https://www.gettv.hk/img/background/3.jpg");
                padding-bottom: 50px;
            }

            .left-pics {
                border-right: none;
                padding: 50px 10% 0 10%;
                height: auto;
                width: 80%;
            }

            .right-product {
                padding-top: 50px;
                height: auto;
                padding-bottom: 50px;
            }

            .bigPic,
            #div0 {
                height: 450px;
                background-image: url("https://www.gettv.hk/img/nopic.png");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center center;
                border: 1px solid #ccc;
            }

            .consmall {
                display: grid;
                grid-template-columns: 22% 22% 22% 22%;
                grid-column-gap: 4%;
                margin-top: 30px;
                height: 100px;
            }

            #div1,
            #div2,
            #div3,
            #div4 {
                height: 95%;
                background-image: url("https://www.gettv.hk//img/nopic.png");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center center;
                border-style: solid;
                border: 1px solid #ccc;
                margin-top: 2px;
                visibility: hidden;

            }

            .fullWidth {
                width: 100%;
                margin-bottom: 20px;
                display: flex;
            }

            /* #head {
                background-image: url('./img/symbol/s5.png');
                width: 60px;
                height: 60px;
                background-size: cover;
                grid-column-start: 1;
                grid-column-end: 2;
                grid-row-start: 1;
                grid-row-end: 3;

            } */

            .yaqzaan {
                float: left;
            }

            svg.new {
                margin: 5px;
                height: 32px;
                width: 80px;
                border-radius: 2px;
                display: inline-block;
            }

            .store {
                font-size: 23px;
                display: inline-block;
                padding-top: 10px;
            }

            .dollar {
                font-size: 2em;
                margin-bottom: 20px;
            }


            #location {
                width: 30px;
                height: 30px;
                background-image: url('https://www.gettv.hk/img/icon/location.png');
                background-size: cover;
                display: inline-block;
            }

            .b1 {
                display: inline-block;
                margin-left: 10px;
            }

            #delivery {
                width: 30px;
                height: 30px;
                background-image: url('https://www.gettv.hk/img/icon/delivery.png');
                background-size: cover;
                display: inline-block;
            }

            .b2 {
                display: inline-block;
                margin-left: 10px;
            }

            .quan {
                font-size: 20px;
                display: inline-block;
            }

            .control {
                display: inline-block;
            }

            .storage {
                display: inline-block;
                font-size: 20px;
                margin-left: 10px;
            }

            #buy {
                background-color: lightcoral;
                width: 140px;
                height: 45px;
                border-radius: 3px;
                color: white;
                border: none;
                font-size: large;
            }

            #contact {
                background-color: grey;
                width: 140px;
                height: 45px;
                border-radius: 3px;
                color: white;
                border: none;
                font-size: large;
                margin-top: 52px;
            }

            .b3 {
                margin-top: 20px;
            }

            .bigsize {
                font-size: 25px;
                background-image: url('./img/');
                margin-top: 110px;
            }

            /* .sMes {
                margin-top: 15px;
            } */

            .tagContainer {}

            .tag {
                display: inline-block;
            }

            #tagbutton {
                border-radius: 8px;
                padding-left: 14px;
                padding-right: 14px;
                background: white;
                border: 2px solid #a7a7a7;
                color: #000;

            }

            a:link,
            a:visited {
                text-decoration: none;
                color: black;
            }

            a:hover {
                text-decoration: none;

            }

            .buttontag {
                display: inline-block;
            }

            .myButton {
                background: linear-gradient(to bottom, #ededed 5%, #dfdfdf 100%);
                background-color: #ededed;
                border-radius: 28px;
                border: 1px solid #dcdcdc;
                display: inline-block;
                cursor: pointer;
                color: black;
                font-family: Arial;
                font-size: 17px;
                padding: 0px 20px;
                text-decoration: none;
                text-shadow: 0px 1px 0px #ffffff;
            }

            .myButton:hover {
                background: linear-gradient(to bottom, #dfdfdf 5%, #ededed 100%);
                background-color: #dfdfdf;
            }

            .myButton:active {
                position: relative;
                top: 1px;
            }


            .userinfo {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 30px;
            }

            #usericon {
                display: flex;
            }

            #a1 {
                display: inline-block;
                font-size: 15px;
            }

            #a2 {
                display: inline-block;
                font-size: 15px;
                margin-left: 5px;
            }

            #a1 img {
                width: 40px;
                height: 40px;
                border-radius: 9999999999999px;
            }

            /* .user {
                width: 100px;
                height: 100px;
            } */

            #t1 {
                margin-left: 350px;
            }

            .myButton1 {
                box-shadow: inset 0px 1px 0px 0px #f29c93;
                background: linear-gradient(to bottom, #fe1a00 5%, #ce0100 100%);
                background-color: #fe1a00;
                border-radius: 3px;
                border: 1px solid #d83526;
                display: inline-block;
                cursor: pointer;
                color: #ffffff;
                font-family: Arial;
                font-size: 13px;
                padding: 6px 24px;
                text-decoration: none;
                text-shadow: 0px 1px 0px #b23e35;
            }

            .myButton1:hover {
                background: linear-gradient(to bottom, #ce0100 5%, #fe1a00 100%);
                background-color: #ce0100;
            }

            .myButton1:active {
                position: relative;
                top: 1px;
            }

            .deliveryDesc {
                margin-top: 20px;
            }

            @media only screen and (max-width: 768px) {
                .change-new-product-container {
                    grid-template-columns: 100%;
                }

                .left-pics {
                    width: 100%;
                    margin-left: 0px;
                    margin-right: 0px;
                    padding-left: 0px;
                    padding-right: 0px;
                }

                .right-product {
                    width: 90%;
                    padding: 20px;
                }
            }
        </style>
        <!-- <a data-fancybox="gallery" href="http://www.gettv.hk/img/WX20200513-110548@2x.png"><img src="http://www.gettv.hk/img/WX20200513-110548@2x.png"></a> -->
        <div class="top-banner">
            <img id="banner3" src="http://www.gettv.hk/img/WX20200513-110548@2x.png" data-animation-effect="true" href="http://www.gettv.hk/img/WX20200513-110548@2x.png">
            <!-- ./img/WX20200513-110548@2x.png -->
        </div>

        <!-- <div>
            <ul>
                <li><span>主頁 / </span></li>
                <li><span>家居生活 / </span></li>
                <li><span>家居 / </span></li>
                <li><span>儲物 / </span></li>
            </ul>
        </div> -->

        <change-edit-bar></change-edit-bar>

        <div class="outer">
            <div class="change-new-product-container">
                <div class="left-pics">
                    <!-- input pictures -->
                    <div class="bigPic" id="div0"></div>
                    <div>

                        <!-- GG get Array Pic from Database -->
                        <div class="consmall" on-click="_test">
                            <div>
                                <div id="div1"></div>
                            </div>
                            <div>
                                <div id="div2"></div>
                            </div>
                            <div>
                                <div id="div3"></div>
                            </div>
                            <div>
                                <div id="div4"></div>
                            </div>
                        </div>
                    </div>
                    <!-- <vaadin-dialog id="picslide"></vaadin-dialog> -->
                </div>

                <div class="right-product">
                    <div class="fullWidth">
                        <div class="yaqzaan" style="display: inline-block;">
                            
                            <template is="dom-if" if="{{product.isNew}}">
                                <svg class="new">
                                <polygon points="0,0 80,0 60,32 0,32" style="fill:#ebbd35;stroke:#ebbd35;stroke-width:0"></polygon><text x="6" y="23" fill="white" id="isNew" >全新</text>
                                    </svg>
                            </template>

    <template is="dom-if" if="{{!product.isNew}}">
                                    <svg class="new">
                                        <polygon points="0,0 80,0 60,32 0,32" style="fill:#7cd3da;stroke:#7cd3da;stroke-width:0"></polygon><text x="6" y="23" fill="white" id="isNew" >二手</text>
                                    </svg>
                              </template>
    </div>

    <div style="display: inline-block;">
        <span id="pn" class="store">{{product.productname}}</span>
    </div>
    </div>

    <a id="userSite" href="#">
        <div class="userinfo">
            <div id="usericon">
                <div id="a1">
                    <img class="head" src$="{{owner.head}}">
                </div>
                <div id="a2">
                    <div class="name" id="owner">{{username}}</div>
                </div>
            </div>
        </div>
    </a>



    <div class="dollar" id="aaa">${{product.price}}</div>

    <hr>

    <div>
        <div id="location"></div>
        <p id="dis" class="b1">

            {{product.district}}
        </p>
    </div>
    <div>
        <div id="delivery"></div>
        <p id="dm" class="b2">
            {{product.deliveryMethod}}
        </p>
    </div>
    <hr>
    <br>
    <button id="contact" on-click="_findseller">聯絡賣家</button>
    <vaadin-dialog id="seller"></vaadin-dialog>

    <div class="b3">刊登於 {{timeStr}}</div>
    <br>

    <div class="bigsize">
        <span>產品資料:</span>
    </div>
    <br>
    <div class="unib">
        {{product.description}}
    </div>
    <br>

    <div class="tagContainer">
        <div class="tag">
            <span> 標籤： </span>
        </div>
        <div class="buttontag">
            <div id="t"></div>
        </div>
    </div>
    <br>
    <hr>

    <div>
        <span class="bigsize">運輸：</span>
        <div class="deliveryDesc">
            {{product.deliveryDesc}} </div>


    </div>
    <br>
    </div>

    </div>
    </div>


    </template>

</dom-module>

<script>
    (function() {
        Polymer({
            is: 'change-new-product',
            properties: {
                "id": {
                    "type": String
                },
                "uid": {
                    "type": String
                }

                //For testing call SELLER from webcom
                // "sellerid": {
                //     "type": String
                // }
            },
            created: function() {
                console.log("Entered Created");
                // call close pop-up in change-confirm
                document.addEventListener('close-item-dialog', e => {
                    this.shadowRoot.querySelector('vaadin-dialog').opened = false;
                    // console.log("(Btn) close successfully");
                });

                let user = store.get('change-user') || null;
                this.user = user;
                if (user)
                    this.fileManager = new AwsPackage(user);

                this.dataManager = new DataPackage('product');
                this.userManager = new DataPackage('_user');
                this.orderManager = new DataPackage('order');

            },
            initProduct(prod) {
                let that = this;
                let shadow = this.shadowRoot;

                this.product = prod;
                // let a = res.resolve['price'];
                // shadow.querySelector('#aaa').innerHTML = "$" + a;
                if (!this.product['pics']) {} else {
                    if (!Array.isArray(this.product['pics']))
                        this.product['pics'] = [this.product['pics']];

                    for (qwe = 0; qwe < this.product['pics'].length; qwe++) {
                        if (this.product['pics'][qwe]) {
                            shadow.querySelector('#div' + qwe).style.backgroundImage = 'url(' + this.product['pics'][qwe] + ')';
                            shadow.querySelector('#div' + qwe).style.visibility = "visible";
                            shadow.querySelector('#div' + qwe).setAttribute('data-animation-effect',true);
                            shadow.querySelector('#div' + qwe).setAttribute('href',this.product['pics'][qwe]);
                        }
                    }
                }



                if (prod.isFanpage || prod.isFanpage == true) {

                }
                that.timeStr = that.loadUpdate(prod.createTime);
                this.loadTags();
                // shadow.querySelector('.unib').innerHTML = this.product['description'];
                // shadow.querySelector('.deliveryDesc').innerHTML = this.product['deliveryDesc'];
                this.loadOwner();
                if (this.user) {
                    let orderList = document.createElement('change-orderlist-storage');
                    orderList.orders = this.product['replyArray'];
                    this.product['replyArray'].forEach(item => {
                        let listItem = document.createElement('change-order-list');
                        listItem.id = item;
                        listItem.product = this.product;
                        listItem.setAttribute('id', item);
                        orderList.appendChild(listItem);
                    });
                    shadow.appendChild(orderList);

                }
            },
            ready: function() {
                let div0 = this.shadowRoot.querySelector('#div0');
                let div1 = this.shadowRoot.querySelector('#div1');
                let div2 = this.shadowRoot.querySelector('#div2');
                let div3 = this.shadowRoot.querySelector('#div3');
                let div4 = this.shadowRoot.querySelector('#div4');
                $(div0).fancybox();
                $(div1).fancybox();
                $(div2).fancybox();
                $(div3).fancybox();
                $(div4).fancybox();
                console.log("Entered Ready");
                let loc = location.search;
                let pid = "";
                let posit = 0;
                for (i = 2; i < loc.length; i++) {
                    pid += loc[i]
                };

                //For testing call SELLER from webcom
                // this.SELLER = pid;

                let that = this;
                let shadow = this.shadowRoot;
                console.log("good123123");
                this.loadProduct(pid).then(prod => {
                    console.log('Product', prod);
                    this.uid = prod['ownerId']
                    this.initProduct(prod);
                }, err => {
                    alert('不能載入資料');
                });

                // let Url = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                // let params = {
                //     "action": "getData",
                //     "index": "change",
                //     "type": "product",
                //     "id": pid
                // }
                // let user = store.get('change-user') || null;
                // if (user) {
                //     shadow.querySelector('#contact').style.visibility = "visible";
                // }

                // Polymer.postData(Url, params).then(res => {
                //     console.log("Result", res);
                //     if (res.code > 0) {
                //         let a = res.resolve['price'];
                //         shadow.querySelector('#aaa').innerHTML = "$" + a;
                //         let b = res.resolve['pics'];
                //         let imglen = [];
                //         for (qwe = 0; qwe < b.length; qwe++) {
                //             if (b[qwe] == "") {
                //                 shadow.querySelector('#div' + qwe).style.visibility = "hidden";

                //             } else {
                //                 imglen.push(b[qwe])
                //             }
                //         }
                //         let lenb = imglen.length;
                //         for (q22 = 0; q22 < lenb; q22++) {
                //             shadow.querySelector('#div' + q22).style.backgroundImage = 'url(' + imglen[q22] + ')';
                //         };

                //         let c = res.resolve['productname'];
                //         shadow.querySelector('#pn').innerHTML = c;

                //         //get and pass tag data
                //         let itemtag = "";
                //         for (count = 0; count < res.resolve['tags'].length; count++) {
                //             itemtag += '<button id=\"tagbutton\">' + '<a href="list-product.html?tag=' + encodeURIComponent(res.resolve['tags'][count]) + '">' + res.resolve['tags'][count] + "</a></button>";
                //         }
                //         shadow.querySelector('#t').innerHTML = itemtag;

                //         //get and pass description data
                //         let description = res.resolve['description'];
                //         shadow.querySelector('.unib').innerHTML = description;

                //         //get and pass seller message data
                //         // let sellerMsg = res.resolve['sellerMsg'];
                //         // shadow.querySelector('.sMes').innerHTML = sellerMsg;

                //         //get and pass deliveryDesc data
                //         let deliveryDesc = res.resolve['deliveryDesc'];
                //         shadow.querySelector('.deliveryDesc').innerHTML = deliveryDesc;

                //         //DETERMIN WHETHER IT IS UPLOADED BY FANPAGE OR USERS & GET BACK REQUIRED NAME, HEAD AND LINK
                //         let o = res.resolve['ownerId'];
                //         let isFanpage = res.resolve['isFanpage'];
                //         if (isFanpage == true) {
                //             shadow.querySelector('#owner').innerHTML = res.resolve['fanpage'];
                //             let parampage = {
                //                 "action": "searchData",
                //                 "index": "change",
                //                 "type": "pages",
                //                 "body": {
                //                     "query": {
                //                         "match": {
                //                             "name": res.resolve['fanpage']
                //                         }
                //                     }
                //                 }
                //             };
                //             Polymer.postData(Url, parampage).then(res => {
                //                 shadow.querySelector('.head').src = res.resolve[0]['head'];
                //                 this.link = "/" + res.resolve[0]['website'];
                //             });
                //         } else {
                //             let p = {
                //                 "action": "searchData",
                //                 "index": "change",
                //                 "type": "_user",
                //                 "body": {
                //                     "query": {
                //                         "match": {
                //                             "_id": o
                //                         }
                //                     }
                //                 }
                //             };
                //             Polymer.postData(Url, p).then(res => {
                //                 if (res.code > 0) {
                //                     let un = res.resolve[0]['username'];
                //                     shadow.querySelector('#owner').innerHTML = un;
                //                     shadow.querySelector('.head').src = res.resolve[0]['head'];
                //                     this.link = "/user.html?" + res.resolve[0]['id'];
                //                 }
                //             });

                //         };



                //         // let f = res.resolve['isNew'];
                //         // if (f == true) {
                //         //     shadow.querySelector('.n').innerText = "全新";
                //         // } else {
                //         //     shadow.querySelector('.o').innerHTML = "二手";
                //         // }
                //         let thenew = ""
                //         if (res.resolve['isNew'] == true) {
                //             thenew = "<polygon points=\"0,0 80,0 60,32 0,32\" style=\"fill:#ebbd35;stroke:#ebbd35;stroke-width:0\"></polygon><text x=\"6\" y=\"23\" fill=\"white\" id=\"isNew\" >全新</text>"

                //         } else {
                //             thenew = "<polygon points=\"0,0 80,0 60,32 0,32\" style=\"fill:#7cd3da;stroke:#7cd3da;stroke-width:0\"></polygon><text x=\"6\" y=\"23\" fill=\"white\" id=\"isNew\" >二手</text>"
                //         }
                //         shadow.querySelector('.new').innerHTML = thenew;

                //         let g = res.resolve['district'];
                //         shadow.querySelector('#dis').innerHTML = g;

                //         let h = res.resolve['deliveryMethod'];
                //         shadow.querySelector('#dm').innerHTML = h;
                //     } else {
                //         alert("fail");
                //     }
                // })

            },
            loadProduct(pid) {
                return new Promise(function(resolve, reject) {
                    Polymer.getContent('/json/product-' + pid + '.json?id=' + new Date().getTime()).then(res => {
                        resolve(JSON.parse(res));
                    }, err => {
                        this.dataManager.loadData(pid).then(prod => {
                            resolve(prod);
                        });
                    });
                    // this.fileManager.getFile('json/product-' + pid + '.json').then(res => {
                    //     let json = JSON.parse(res);
                    // });
                });


            },
            _findseller: function() {
                let user = store.get('change-user') || null;
                loc = location.search;
                let posit = 0;
                let pid = "";
                for (i = 2; i < loc.length; i++) {
                    pid += loc[i];
                };
                let uid = this.uid;
                //**NEW USERS USE "id"
                // console.log("CURRENT UID (new users)", user['id']);
                //**OLD USERS USE "_id"
                // console.log("CURRENT UID (old users", user['_id']);

                console.log("CURRENT PRODUCT OWNER", uid);
                if (user == null) {
                    alert("請先登入!");
                } else if (user['id'] == uid || user['_id'] == uid) {
                    alert("不能留言自己貨物!");
                } else {
                    console.log('contacting seller');
                    let shadow = this.shadowRoot;
                    let that = this;
                    let popup = document.createElement('change-webcom');
                    popup.seller = this.owner;
                    popup.product = this.product;
                    this.componentPopup(popup, '500px', '400px');

                    // Polymer.popup(dialog, "change", "change-webcom", "500px", "400px");
                    console.log("end process in contact seller");
                }
            },

            componentPopup(component, width, height) {
                let dialog = this.shadowRoot.querySelector('vaadin-dialog#seller');
                // let dialog = Polymer.dialog;
                // let dialog = document.querySelector('vaadin-dialog');
                dialog.renderer = function(root, dialog) {
                    // root.innerHTML = '<' + component + '></' + component + '>';
                    if (root.firstElementChild) {
                        return;
                    }
                    root.appendChild(component);
                };

                dialog.resizable = true;
                dialog.resize(width, height);
                dialog.opened = true;
                // Polymer.activeDialog = dialog;   

            },

            // _test: function () {
            //     let shadow = this.shadowRoot;
            //     let that = this;
            //     let dialog = shadow.querySelector('vaadin-dialog#picslide');
            //     Polymer.popup(dialog, "change", "change-picslide", "753px", "573px");
            // }

            loadImages(imgs) {

            },

            loadTags() {
                let shadow = this.shadowRoot;
                //get and pass tag data
                let itemtag = "";
                let tags = document.createElement('div');
                for (var count = 0; count < this.product['tags'].length; count++) {
                    let button = document.createElement('button');
                    button.setAttribute('id', 'tagbutton');
                    let a = document.createElement('a');
                    a.setAttribute('href', '/list-product.html?tag=' + this.product['tags'][count]);
                    a.innerHTML = this.product['tags'][count];
                    button.appendChild(a);
                    tags.appendChild(button);
                    // itemtag += '<button id=\"tagbutton\">' + '<a href="list-product.html?tag=' + encodeURIComponent(res.resolve['tags'][count]) + '">' + res.resolve['tags'][count] + "</a></button>";
                }
                console.log('Tag', tags);
                shadow.querySelector('#t').innerHTML = tags.innerHTML;
            },


            loadOrder(pid) {
                let that = this;
                return new Promise(function(resolve, reject) {
                    Polymer.getContent('/json/order-' + pid + '.json?id=' + new Date().getTime()).then(res => {
                        resolve(JSON.parse(res));
                    }, err => {
                        that.orderManager.loadData(pid).then(prod => {
                            resolve(prod);
                        });
                    });
                    // this.fileManager.getFile('json/product-' + pid + '.json').then(res => {
                    //     let json = JSON.parse(res);
                    // });
                });


            },
            loadUser(userId) {
                let that = this;
                let url = "/json/user-" + userId + ".json?id=" + new Date().getTime();
                Polymer.getContent(url).then(res => {
                    that.owner = JSON.parse(res)
                    that.username = that.owner['username'];
                    this.shadowRoot.querySelector('#userSite').setAttribute('href', '/user.html?' + userId);

                })

            },
            loadPage(pageId) {
                let that = this;
                let url = "/json/user-" + userId + ".json?id=" + new Date().getTime();
                Polymer.getContent(url).then(res => {
                    that.owner = JSON.parse(res)
                    that.username = that.owner['pagename']
                    this.shadowRoot.querySelector('#userSite').setAttribute('href', that.owner['website']);

                })
            },
            // ownerSite(){
            //     let isFanpage = this.product['isFanpage'] || null;

            //     if (!isFanpage) 
            //         this.shadowRoot.querySelector('#userSite').setAttribute('href','/user.html?'+this.owner['id']);
            //     else
            //         this.shadowRoot.querySelector('#userSite').setAttribute('href',this.pages['website']);
            // },
            loadOwner() {
                let o = this.product['ownerId'];
                let isFanpage = this.product['isFanpage'] || null;
                // console.log('is Fan Page', isFanpage);
                if (!isFanpage || isFanpage == false)
                    this.loadUser(o);
                else
                    this.loadPage(o);

            },
            loadUpdate(time) {
                let _thetimenow = Date.now();
                let comparetime = (_thetimenow - time) / 1000;
                if (comparetime < 60) {
                    return "剛剛";
                } else if (comparetime / 60 < 60) {
                    return Math.floor(comparetime / 60) + "分鐘前";
                } else if (comparetime / 60 / 60 < 24) {
                    return Math.floor(comparetime / 60 / 60) + "小時前";
                } else if (comparetime / 60 / 60 / 24 < 7) {
                    return Math.floor(comparetime / 60 / 60 / 24) + "日前";
                } else if (comparetime / 60 / 60 / 24 / 7 < 30) {
                    return Math.floor(comparetime / 60 / 60 / 24 / 7) + "星期前";
                } else if (comparetime / 60 / 60 / 24 / 7 / 30 < 365) {
                    return Math.floor(comparetime / 60 / 60 / 24 / 30) + "月前";
                }
            }
        });
    })();
</script>