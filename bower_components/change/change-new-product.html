<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-text-field/vaadin-email-field.html">
<link rel="import" href="../vaadin-text-field/vaadin-password-field.html">
<link rel="import" href="../vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="../vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../vaadin-text-field/vaadin-number-field.html">
<link href="../dz-menu/css/style.html" rel="import" />
<link rel="import" href="../vaadin-button/vaadin-button.html">

<link rel="import" href="../vaadin-dialog/vaadin-dialog.html">

<link rel="import" href="../change/change-dropzone-file.html">
<link rel="import" href="../change/change-buy.html">
<link rel="import" href="../change/change-webcom.html">
<link rel="import" href="change-edit-bar.html">



<dom-module id="change-new-product">

    <template>
        <style include="icon-styles"></style>
        <style>
            * {
                color: black;
                font-family: sans-serif, Microsoft JhengHei;
            }

            vaadin-dialog[part="content"] {
                padding: 0px;
                overflow: hidden;
            }

            hr {
                max-width: 100px;
                margin-left: 0;
                margin-bottom: 10px;
            }

            ul {
                display: flex;
                margin-bottom: 0px;
            }

            li {
                list-style: none;
            }

            .top-banner {
                margin-right: 1%;
                background: #FFE9BF;
                background-repeat: no-repeat;
                background-size: contain;
                height: 100%;
            }

            #banner3 {
                width: 100%;
                height: auto;
                display: block;
            }

            .change-new-product-container {
                display: grid;
                grid-template-columns: 1fr 0.8fr;
                height: auto;
                margin: 0 auto;
                background: white;
                width: 92.5%;
                border: solid 1px #ccc;
            }

            button {
                cursor: pointer;
            }

            .buttons button {
                padding: 3px;
                margin-top: 20px;
            }

            #upload {
                border-radius: 0;
                padding: 8px;
                float: right;
                margin-top: 30px;
                min-block-size: fit-content;
                border: 1px solid #ccc;
                width: 22%;
                height: 40px;
                background-color: white;
            }

            .u {
                margin-right: 0;
            }

            .outer {
                margin: 0;
                width: 100%;
                background-image: url(http://change.dazzle.website/img/background/3.jpg);
                padding-bottom: 50px;
            }

            .left-pics {
                border-right: none;
                padding: 50px 100px 0 100px;
                height: auto;
            }

            .right-product {
                padding-top: 50px;
                height: auto;
                padding-bottom: 50px;
            }

            .bigPic,
            #div0 {
                height: 450px;
                background-image: url(http://change.dazzle.website/img/nopic.png);
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center center;
                border: 1px solid #ccc;
            }

            .consmall {
                display: grid;
                grid-template-columns: 22% 22% 22% 22%;
                grid-column-gap: 4%;
                margin-top: 30px;
                height: 100px;
            }

            #div1,
            #div2,
            #div3,
            #div4 {
                height: 95%;
                background-image: url("http://change.dazzle.website/img/nopic.png");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center center;
                border-style: solid;
                border: 1px solid #ccc;
                margin-top: 2px;
                visibility: visible;

            }

            .fullWidth {
                width: 100%;
                margin-bottom: 20px;
                display: flex;
            }

            /* #head {
                background-image: url('http://change.dazzle.website/img/symbol/s5.png');
                width: 60px;
                height: 60px;
                background-size: cover;
                grid-column-start: 1;
                grid-column-end: 2;
                grid-row-start: 1;
                grid-row-end: 3;

            } */

            .yaqzaan {
                float: left;
            }

            svg.new {
                margin: 5px;
                height: 32px;
                width: 80px;
                border-radius: 2px;
                display: inline-block;
            }

            .store {
                font-size: 23px;
                display: inline-block;
                padding-top: 10px;
            }

            .dollar {
                font-size: 2em;
                margin-bottom: 20px;
            }


            #location {
                width: 30px;
                height: 30px;
                background-image: url('http://change.dazzle.website/img/icon/location.png');
                background-size: cover;
                display: inline-block;
            }

            .b1 {
                display: inline-block;
                margin-left: 10px;
            }

            #delivery {
                width: 30px;
                height: 30px;
                background-image: url('http://change.dazzle.website/img/icon/delivery.png');
                background-size: cover;
                display: inline-block;
            }

            .b2 {
                display: inline-block;
                margin-left: 10px;
            }

            .quan {
                font-size: 20px;
                display: inline-block;
            }

            .control {
                display: inline-block;
            }

            .storage {
                display: inline-block;
                font-size: 20px;
                margin-left: 10px;
            }

            #buy {
                background-color: lightcoral;
                width: 140px;
                height: 45px;
                border-radius: 3px;
                color: white;
                border: none;
                font-size: large;
            }

            #contact {
                background-color: grey;
                width: 140px;
                height: 45px;
                border-radius: 3px;
                color: white;
                border: none;
                font-size: large;
                margin-top: 52px;
                visibility: hidden;

            }

            .b3 {
                margin-top: 20px;
            }

            .bigsize {
                font-size: 25px;
                background-image: url('http://change.dazzle.website/img/');
                margin-top: 110px;
            }

            /* .sMes {
                margin-top: 15px;
            } */

            .tagContainer {}

            .tag {
                display: inline-block;
            }

            #tagbutton {
                background-color: #e9e9e9;
                text-align: center;
                padding-left: 13px;
                padding-right: 13px;
                border: none;
                border-radius: 15px;

            }

            a:link,
            a:visited {
                text-decoration: none;
                color: black;
            }

            a:hover {
                text-decoration: none;

            }

            .buttontag {
                display: inline-block;
            }

            .myButton {
                background: linear-gradient(to bottom, #ededed 5%, #dfdfdf 100%);
                background-color: #ededed;
                border-radius: 28px;
                border: 1px solid #dcdcdc;
                display: inline-block;
                cursor: pointer;
                color: black;
                font-family: Arial;
                font-size: 17px;
                padding: 0px 20px;
                text-decoration: none;
                text-shadow: 0px 1px 0px #ffffff;
            }

            .myButton:hover {
                background: linear-gradient(to bottom, #dfdfdf 5%, #ededed 100%);
                background-color: #dfdfdf;
            }

            .myButton:active {
                position: relative;
                top: 1px;
            }


            .userinfo {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                margin-bottom: 30px;
            }

            #usericon {
                display: flex;
            }

            #a1 {
                display: inline-block;
                font-size: 15px;
            }

            #a2 {
                display: inline-block;
                font-size: 15px;
                margin-left: 5px;
            }

            #a1 img {
                height: 40px;
            }

            /* .user {
                width: 100px;
                height: 100px;
            } */

            #t1 {
                margin-left: 350px;
            }

            .myButton1 {
                box-shadow: inset 0px 1px 0px 0px #f29c93;
                background: linear-gradient(to bottom, #fe1a00 5%, #ce0100 100%);
                background-color: #fe1a00;
                border-radius: 3px;
                border: 1px solid #d83526;
                display: inline-block;
                cursor: pointer;
                color: #ffffff;
                font-family: Arial;
                font-size: 13px;
                padding: 6px 24px;
                text-decoration: none;
                text-shadow: 0px 1px 0px #b23e35;
            }

            .myButton1:hover {
                background: linear-gradient(to bottom, #ce0100 5%, #fe1a00 100%);
                background-color: #ce0100;
            }

            .myButton1:active {
                position: relative;
                top: 1px;
            }

            .deliveryDesc {
                margin-top: 20px;
            }

            @media only screen and (max-width: 768px) {
                .change-new-product-container {
                    grid-template-columns: 100%;
                }

                .left-pics {
                    width: 100%;
                    margin-left: 0px;
                    margin-right: 0px;
                    padding-left: 0px;
                    padding-right: 0px;
                }

                .right-product {
                    width: 90%;
                    padding: 20px;
                }
            }
        </style>

        <div class="top-banner">
            <img id="banner3" src="http://change.dazzle.website/img/WX20200513-110548@2x.png">
        </div>

        <!-- <div>
            <ul>
                <li><span>主頁 / </span></li>
                <li><span>家居生活 / </span></li>
                <li><span>家居 / </span></li>
                <li><span>儲物 / </span></li>
            </ul>
        </div> -->

        <change-edit-bar></change-edit-bar>

        <div class="outer">
            <div class="change-new-product-container">
                <div class="left-pics">
                    <!-- 这里放图片 -->
                    <div class="bigPic" id="div0"></div>
                    <div>

                        <!-- GG get Array Pic from Database -->
                        <div class="consmall">
                            <div>
                                <div id="div1"></div>
                            </div>
                            <div>
                                <div id="div2"></div>
                            </div>
                            <div>
                                <div id="div3"></div>
                            </div>
                            <div>
                                <div id="div4"></div>
                            </div>
                        </div>
                        <!-- <div class="buttons u">
                                <button id="upload" on-click="_uploadFile">上載圖片</button>
                            </div>
                            <vaadin-dialog></vaadin-dialog> -->
                    </div>
                </div>

                <div class="right-product">
                    <div class="fullWidth">
                        <div class="yaqzaan" style="display: inline-block;">
                            <svg class="new">
                                <!-- <polygon points="0,0 80,0 60,32 0,32"
                                    style="fill:#6AA64F;stroke:#6AA64F;stroke-width:0">
                                </polygon>
                                <text class="n o" x="6" y="23" fill="white" style="font-size:20px;">全新</text> -->
                            </svg>

                        </div>
                        <div style="display: inline-block;">
                            <span id="pn" class="store"></span>
                        </div>
                    </div>
                    <div class="userinfo">
                        <div id="usericon">
                            <div id="a1">
                                <img src="http://change.dazzle.website/img/user_profile.png">
                            </div>
                            <div id="a2">
                                <div class="name" id="owner"></div>
                            </div>
                        </div>
                    </div>

                    <div class="dollar" id="aaa"></div>

                    <hr>

                    <div>
                        <div id="location"></div>
                        <p id="dis" class="b1"></p>
                    </div>
                    <div>
                        <div id="delivery"></div>
                        <p id="dm" class="b2"></p>
                    </div>
                    <hr>
                    <br>
                    <button id="contact" on-click="_findseller">聯絡賣家</button>
                    <div class="b3">刊登於 1小時前</div>
                    <br>

                    <div class="bigsize">
                        <span>產品資料:</span>
                    </div>
                    <br>
                    <div class="unib">
                        <!-- <span id="pn">產品名稱：儲物架</span> -->
                    </div>
                    <br>
                    <!-- <div class="unib"><span>產品尺寸 185x130x30(cm)</span></div>
                        <br> -->
                    <!-- <div class="sMesCon">
                        <div class="sMesText"><span>賣家留言:</span></div>
                        <div class="sMes"></div>
                    </div> -->

                    <br>
                    <div class="tagContainer">
                        <div class="tag">
                            <span> 標籤： </span>
                        </div>
                        <div class="buttontag">
                            <div id="t"></div>
                        </div>
                    </div>
                    <br>
                    <hr>

                    <div>
                        <span class="bigsize">運輸：</span>
                        <div class="deliveryDesc">
                            <p style="margin-bottom: 0px;"></p>
                        </div>


                    </div>
                    <br>
                </div>

            </div>
        </div>




        <vaadin-dialog></vaadin-dialog>

    </template>

</dom-module>

<script>
    (function() {
        Polymer({
            is: 'change-new-product',
            properties: {
                "id": {
                    "type": String
                }
            },
            created: function() {
                // call close pop-up in change-confirm
                document.addEventListener('close-item-dialog', e => {
                    this.shadowRoot.querySelector('vaadin-dialog').opened = false;
                    // console.log("(Btn) close successfully");
                });

                let user = store.get('change-user') || null;
                if (user)
                    this.fileManager = new AwsPackage(user);

            },
            ready: function() {
                let loc = location.search;
                let pid = "";
                let posit = 0;
                for (i = 1; i < loc.length; i++) {
                    if (loc[i] == "u") {
                        posit = i;
                    };
                };
                for (a = 2; a < posit; a++) {
                    pid += loc[a];
                }
                console.log("pid", pid);
                let that = this;
                let shadow = this.shadowRoot;
                let Url = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                let params = {
                    "action": "getData",
                    "index": "change",
                    "type": "product",
                    "id": pid
                }
                let user = store.get('change-user') || null;
                if (user) {
                    shadow.querySelector('#contact').style.visibility = "visible";

                }

                Polymer.postData(Url, params).then(res => {
                    console.log("Result", res);
                    if (res.code > 0) {
                        let a = res.resolve['price'];
                        shadow.querySelector('#aaa').innerHTML = "$" + a;
                        let b = res.resolve['pics'];
                        let imglen = [];
                        for (qwe = 0; qwe < b.length; qwe++) {
                            if (b[qwe] == "") {
                                shadow.querySelector('#div' + qwe).style.visibility = "hidden";

                            } else {
                                imglen.push(b[qwe])
                            }
                        }
                        let lenb = imglen.length;
                        for (q22 = 0; q22 < lenb; q22++) {
                            shadow.querySelector('#div' + q22).style.backgroundImage = 'url(' + imglen[q22] + ')';
                        };

                        let c = res.resolve['productname'];
                        shadow.querySelector('#pn').innerHTML = c;

                        //get and pass tag data
                        let itemtag = "";
                        for (count = 0; count < res.resolve['tags'].length; count++) {
                            itemtag += '<button id=\"tagbutton\">' + '<a href="list-product.html#' + res.resolve['tags'][count] + '">' + res.resolve['tags'][count] + "</a></button> &nbsp;"
                        }
                        shadow.querySelector('#t').innerHTML = itemtag;

                        //get and pass description data
                        let description = res.resolve['description'];
                        shadow.querySelector('.unib').innerHTML = description;

                        //get and pass seller message data
                        // let sellerMsg = res.resolve['sellerMsg'];
                        // shadow.querySelector('.sMes').innerHTML = sellerMsg;

                        //get and pass deliveryDesc data
                        let deliveryDesc = res.resolve['deliveryDesc'];
                        shadow.querySelector('.deliveryDesc').innerHTML = deliveryDesc;

                        let o = res.resolve['ownerId'];
                        let p = {
                            "action": "searchData",
                            "index": "change",
                            "type": "_user",
                            "body": {
                                "query": {
                                    "match": {
                                        "_id": o
                                    }
                                }
                            }
                        }
                        Polymer.postData(Url, p).then(reso => {
                            if (res.code > 0) {
                                let un = reso.resolve[0]['username'];
                                shadow.querySelector('#owner').innerHTML = un;
                            }
                        })

                        // let f = res.resolve['isNew'];
                        // if (f == true) {
                        //     shadow.querySelector('.n').innerText = "全新";
                        // } else {
                        //     shadow.querySelector('.o').innerHTML = "二手";
                        // }
                        let thenew = ""
                        if (res.resolve['isNew'] == true) {
                            thenew = "<polygon points=\"0,0 80,0 60,32 0,32\" style=\"fill:#ebbd35;stroke:#ebbd35;stroke-width:0\"></polygon><text x=\"6\" y=\"23\" fill=\"white\" id=\"isNew\" >全新</text>"

                        } else {
                            thenew = "<polygon points=\"0,0 80,0 60,32 0,32\" style=\"fill:#7cd3da;stroke:#7cd3da;stroke-width:0\"></polygon><text x=\"6\" y=\"23\" fill=\"white\" id=\"isNew\" >二手</text>"
                        }
                        shadow.querySelector('.new').innerHTML = thenew;

                        let g = res.resolve['district'];
                        shadow.querySelector('#dis').innerHTML = g;

                        let h = res.resolve['deliveryMethod'];
                        shadow.querySelector('#dm').innerHTML = h;
                    } else {
                        alert("fail")
                    }
                })

            },
            loadProduct(pid) {
                this.fileManager.getFile('json/product-' + pid + '.json').then(res => {
                    let json = JSON.parse(res);

                });
            },
            _findseller: function() {
                let user = store.get('change-user') || null;
                if (user == null) {
                    alert("請先登入!");
                } else {
                    console.log('contacting seller');
                    let shadow = this.shadowRoot;
                    let that = this;
                    let dialog = shadow.querySelector('vaadin-dialog');
                    Polymer.popup(dialog, "change", "change-webcom", "325px", "600px");
                    console.log("end process in contact seller");
                }
            },
        });
    })();
</script>