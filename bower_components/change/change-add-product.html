<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-text-field/vaadin-email-field.html">
<link rel="import" href="../vaadin-text-field/vaadin-password-field.html">
<link rel="import" href="../vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="../vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../vaadin-text-field/vaadin-number-field.html">
<link rel="import" href="../vaadin-select/vaadin-select.html">
<link rel="import" href="../paper-tags-input/paper-tags-input.html">
<link rel="import" href="../vaadin-button/vaadin-button.html">

<link rel="import" href="../vaadin-dialog/vaadin-dialog.html">

<link rel="import" href="change-dropzone-file.html">
<link rel="import" href="change-gallery.html">

<link rel="import" href="https://d25k6mzsu7mq5l.cloudfront.net/bower_components/dz-file-management/change-photo-stock.html">


<link rel="stylesheet" href="">
<link href="../dz-menu/css/style.html" rel="import" />
<link rel="import" href="change-categories-dropdown.html">


<dom-module id="change-add-product">

    <template>
        <style include="icon-styles"></style>
        <style>
            * {
                color: black;
                font-family: sans-serif;
            }

            header {}

            hr {
                max-width: 100px;
                margin-left: 0;
                margin-bottom: 10px;
            }

            ul {
                display: flex;
                margin-bottom: 0px;
            }

            li {
                list-style: none;
            }

            #gand {
                border-radius: 9999999999px;
            }

            .top-banner {
                margin-right: 1%;
                background: #FFE9BF;
                background-repeat: no-repeat;
                background-size: contain;
                height: 100%;
            }

            #banner3 {
                width: 100%;
                height: auto;
                display: block;
            }

            .change-new-product-container {
                display: grid;
                grid-template-columns: 50% 48%;
                margin-bottom: 50px;
                border: 1px solid #ccc;
                margin-left: 15px;
                margin-right: 15px;
            }

            #tbar {
                display: flex;
                justify-content: space-between;
                border: 1px solid #ccc;
                padding-top: 15px;
                padding-bottom: 20px;
                background: #F0F0F0;
                margin-left: 15px;
                margin-right: 15px;
            }

            .custom-select select {
                width: 120px;
                padding: 3px;

            }

            #first {
                padding: 5px;
                margin-right: 25px;
            }

            :host([theme~="custom"][checked]) [part="checkbox"] {
                background-color: green;

            }

            #firstlabel {
                margin-right: 25px;
                margin-top: 22px;
                margin-left: 50px;
            }

            #secondlabel {
                margin-top: 22px;
                margin-left: 25px;
            }

            button {
                cursor: pointer;
            }

            .first {
                margin-right: 30px;
            }

            .buttons button {
                padding: 3px;
                margin-top: 20px;
            }

            #upload {
                border-radius: 0;
                padding: 8px;
                float: right;
                margin-top: 30px;
                min-block-size: fit-content;
                border: 1px solid #ccc;
                width: 22%;
                height: 40px;
                background-color: white;
            }

            .u {
                margin-right: 0;
            }

            #save {
                background-color: #FF6B66;
                padding: 10px 20px;
                margin-right: 25px;
                border: none;
                color: white;
            }

            #post {
                background-color: #ff8262;
                padding: 10px 20px;
                border: none;
                color: white;
            }

            .left-pics {
                width: 90%;
                background-color: white;
                margin-top: 30px;
                margin-left: 35px;
            }

            .right-product {
                width: 100;
                height: 1050px;
                background-color: white;
                margin-top: 30px;
                margin-left: 30px;
            }

            .bigPic {
                height: 45%;
                background-image: url('http://change.dazzle.website/img/nopic.png');
                background-size: 100%;
                background-repeat: no-repeat;
                background-position: center center;
                border: 1px solid #ccc;
            }

            .consmall {
                display: grid;
                grid-template-columns: 22% 22% 22% 22%;
                grid-column-gap: 4%;
                margin-top: 30px;
                height: 100px;
            }

            #div1,
            #div2,
            #div3,
            #div4 {
                height: 95%;
                background-image: url('http://change.dazzle.website/img/nopic.png');
                background-size: 100%;
                background-repeat: no-repeat;
                background-position: center center;
                border-style: solid;
                border: 1px solid #ccc;
                margin-top: 2px;

            }

            .fullWidth {
                width: 100%;
                margin-bottom: 10px;
                display: flex;
            }

            .sellerMES {
                margin-top: 20px; 
                margin-bottom: 20px;
            }

            #sMes {
                resize: none;
                overflow: hidden;
                width: 100%;
            }

            input[type=text],
            input[type=number] {
                padding: 10px 21px;
                margin-left: 15px;
                display: inline-block;
                border: 1px solid #ccc;
                border-radius: 4px;
                box-sizing: border-box;
            }

            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            #pname {
                margin-top: 4px;
                width: 97.5%;
            }

            #price {
                width: 63%;
            }

            #pdes {
                resize: none;
                overflow: hidden;
                width: 100%;
            }

            #trans {
                resize: none;
                overflow: hidden;
                width: 100%;
            }

            #usericon {
                display: flex;
            }

            #a1 {
                display: inline-block;
                font-size: 15px;
            }

            #a2 {
                display: inline-block;
                font-size: 15px;
                margin-left: 5px;
            }

            #a1 img {
                height: 40px;
            }

            #cs1 {
                width: 60px;
                height: 38px;
                padding: 5px;
                font-size: 13px;
            }

            #cs1 option {
                font-size: 13px;
            }

            .checked {
                color: orange;
            }

            .userinfo {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
            }

            .hkd {
                margin-top: 30px;
                margin-bottom: 20px;
            }

            .loca {
                margin: 20px 0 20px 0;
            }

            .del {
                margin-bottom: 20px;
            }

            #edit {
                width: 90px;
                height: 35px;
                border: 1px solid #ccc;
                background-color: white;
            }

            #location {
                width: 30px;
                height: 30px;
                background-image: url(http://change.dazzle.website/img/icon/location.png);
                background-size: cover;
                display: inline-block;
                margin-top: 15px;
            }

            #delivery {
                width: 30px;
                height: 30px;
                background-image: url(http://change.dazzle.website/img/icon/delivery.png);
                background-size: cover;
                display: inline-block;
                margin-top: 15px;
            }


            .bigsize {
                font-size: 25px;
                background-image: url(http://change.dazzle.website/img/);
                margin-top: 70px;
            }

            .tag {
                display: inline-block;
                margin-top: 10px;
            }

            .clearfix {
                display: flex;
            }

            /* [part="input-field"] {
                background-color: white;
            } */
            
            @media only screen and (max-width: 768px) {
                .change-new-product-container {
                    display: grid;
                    grid-template-columns: 100%;
                    margin-bottom: 100px;
                    margin-left: 50px;
                }

                .bigPic {
                    height: 300px;
                }
            }
        </style>
        <style>
            /* 父元素，因为~符号只能匹配下面的兄弟节点，所以使用弹性盒的倒序改变五角星的排列方式 */
            .box {
                width: 266px;
                height: 27px;
                margin: 0 auto;
                display: flex;
                flex-direction: row-reverse;
                justify-content: space-between;
            }

            /* 隐藏单选 */
            input {
                display: none;
            }

            /* 五角星默认样式 */
            input[type="radio"]+label>svg>path {
                d: path("M27.500,1.501 L36.069,16.899 L53.497,20.217 L41.365,33.051 L43.567,50.499 L27.500,43.032 L11.433,50.499 L13.635,33.051 L1.503,20.217 L18.931,16.899 L27.500,1.501 ");
                stroke-width: 1px;
                fill: none;
                stroke: #333;
            }

            /* 移入，点击选中的元素和下面的元素变为实心 */
            input[type="radio"]+label:hover>svg>path,
            input[type="radio"]+label:hover~input[type="radio"]+label>svg>path,
            input[type="radio"]:checked+label>svg>path,
            input[type="radio"]:checked~input[type="radio"]+label>svg>path {
                stroke-width: 0px;
                fill: #f00;
            }
        </style>

        <div class="top-banner">
            <img id="banner3" src="http://change.dazzle.website/img/WX20200513-110548@2x.png">
        </div>
        <!-- 
        <div>
            <ul>
                <li><span>主頁 / </span></li>
                <li><span>家居生活 / </span></li>
                <li><span>家居 / </span></li>
                <li><span>儲物 / </span></li>
            </ul>
        </div> -->

        <header>
            <div id="tbar">
                <div style="display: flex; margin-left: 25px;">
                    <div style="margin-top: 11px; margin-left: 12px;">
                        <vaadin-select id="vs1" placeholder="選擇分類"></vaadin-select>
                    </div>
                    <!-- <change-categories-dropdown id="vs1" style="margin-top: 11px; margin-left: 12px;"></change-categories-dropdown> -->


                    <div style="margin-top: 11px; margin-left: 25px;">
                        <vaadin-select id="pro" placeholder="専頁"></vaadin-select>
                    </div>
                    
                    <!--check box, public-->
                    <!-- <vaadin-checkbox-group label="Label" theme="vertical" id="firstlabel">
                        <vaadin-checkbox theme="custom" value="1" id="public">是否公開(専頁用)</vaadin-checkbox>
                    </vaadin-checkbox-group> -->

                    <!--check box, free-->
                    <vaadin-checkbox-group label="Label" theme="vertical" id="secondlabel">
                        <vaadin-checkbox theme="custom" value="1" id="free">是否免費區
                        </vaadin-checkbox>
                    </vaadin-checkbox-group>

                </div>

                <div class="buttons first">
                    <button id="save" on-click="_saveData">發佈上架</button>
                    <!-- <button id="post">發佈上架</button> -->
                </div>
            </div>
        </header>

        <div class="change-new-product-container">
            <div class="left-pics">
                <!-- 5pics -->
                <div id="div0" class="bigPic productImg" on-click="_uploadFile">
                    <!-- <img src$="{{pics[0]}}" style="width:100%"/> -->
                
                </div>
                <div style="height: 100px;">

                    <!-- GG get Array Pic from Database -->
                    <div class="consmall">
                        <div id="div1"  class="productImg" on-click="_uploadFile"></div>
                        <div id="div2" class="productImg"  on-click="_uploadFile"></div>
                        <div id="div3"  class="productImg" on-click="_uploadFile"></div>
                        <div id="div4" class="productImg"  on-click="_uploadFile"></div>
                    </div>
                    <div class="buttons u">
                        <!-- <button id="upload" on-click="_uploadFile">上載圖片</button> -->
                    </div>
                    <vaadin-dialog></vaadin-dialog>
                </div>

                <div>
                    <div class="sellerMES" id="aaa">
                        <b style="font-size: 20px; color: black;">賣家訊息:</b>
                    </div>
                    <!-- TEXT AREA-->
                    <div class="inputbox">
                        <textarea id="sMes" name="sellermessage" rows="12" placeholder="輸入賣家訊息..."></textarea>
                    </div>
                </div>
            </div>

            <div class="right-product">
                <!-- 这里放右边的产品资料 -->
                <div class="fullWidth">
                    <div class="custom-select">
                        <!-- <select id="cs1">
                            <option value="0">全新</option>
                            <option value="1">二手</option>
                        </select> -->
                        <vaadin-select id="vs4" placeholder="全新" style="width: 90px;"></vaadin-select>
                    </div>

                    <div style="width: 100%;">
                        <!--input box-->
                        <div class="inputbox">
                            <input type="text" id="pname" name="firstname" placeholder="輸入商品標題..." maxlength="14">
                        </div>
                    </div>
                </div>
                <div class="userinfo">
                    <div id="usericon">
                        <div id="a1">
                            <img id="gand" src="http://change.dazzle.website/img/user_profile.png">
                        </div>
                        <div id="a2">
                            <div class="name" id="owner">1234</div>
                        </div>
                    </div>
                </div>

                <div class="hkd" style="display: flex;">
                    <div class="dollar" id="aaa"><b style="font-size: 30px; color: black;">HKD</b></div>
                    <!--input box-->
                    <div class="inputbox">
                        <input type="number" id="price" name="priceHKD" placeholder="輸入商品價錢...">
                    </div>
                </div>
                <hr>


                <div class="loca" style="display: flex;">
                    <div id="location"></div>
                    <div style="margin-top: 11px; margin-left: 12px;">
                        <vaadin-select id="vs2" placeholder="選擇地區"></vaadin-select>
                    </div>
                </div>



                <div class="del" style="display: flex;">
                    <div id="delivery"></div>
                    <div style="margin-top: 11px; margin-left: 12px;">
                        <vaadin-select id="vs3" placeholder="選擇發送方法"></vaadin-select>
                    </div>
                </div>

                <hr>



                <div class="">
                    <div style="margin-top: 20px; margin-bottom: 30px;"><span style="font-size: 20px;">產品描述:</span>
                    </div>
                    <!--typing box-->
                    <div class="inputbox">
                        <textarea id="pdes" name="productdescription" rows="12" placeholder="輸入商品描述..."></textarea>
                    </div>
                </div>

                <div style="display: flex; margin-top: 45px;">
                    <div class="tag">
                        <div><span style="font-size: 20px;"> 標籤： </span></div>
                    </div>

                    <!--Henry version-->
                    <vaadin-text-field id="inputTags" on-keydown="_addTags"></vaadin-text-field>
                    <paper-tags-input width="100%" id="myTags"></paper-tags-input>

                </div>
                <hr>

                <div>
                    <div style="margin-top: 20px; margin-bottom: 30px;"><span class="bigsize">運輸：</span></div>
                    <!--input box-->
                    <div class="inputbox">
                        <textarea id="trans" name="transportation" rows="10" placeholder="輸入物流資料..."></textarea>
                    </div>

                </div>
                <br>
            </div>

        </div>
    </template>

</dom-module>

<script>
    //function for database
    (function() {
        Polymer({
            is: 'change-add-product',
            properties: {
                "id": {
                    "type": String
                },

                "valueArray": {
                    "type": Array
                },

                next: {
                    "type": Number
                }
            },
            created: function() {
                let shadow = this.shadowRoot;

                this.bigPic = "http://change.dazzle.website.s3.amazonaws.com/files/1/1591944377549.jpeg";
                this.pics = [];
                this.pics[0] = this.bigPic;
                console.log("Created Add Product");
                // document.addEventListener('upload-success', e => {
                //     let src = e.detail['Key'];
                //     // this.pics.push(src);
                //     // this.bigPic = "http://change.dazzle.website/"+src;
                //     this.curElm.setAttribute('src',src);
                //     console.log('Detail', e, this.pics);
                //     // this.reNewPic();
                // });
                document.addEventListener('select-image', e => {
                    let Key = e.detail['Key'];
                    // this.pics.push(Key);
                    this.curElm.style.backgroundImage = 'url(' + Key + ')';
                    console.log('Select Image', e, this.pics);
                    this.getAllPics();
                    this.closeDialog();
                });
            },
            reNewPic(src) {
                let shadow = this.shadowRoot;
                let noImage = 'http://change.dazzle.website/img/1200px-No_image_3x4.svg.png';
                let i = 0;
                this.pics.forEach(item => {
                    shadow.querySelector('#div' + i).style.backgroundImage = 'url(' + this.pics[i] || noImage + ')';
                    i++;
                });

                // shadow.querySelector('#div1').style.backgroundImage = url(this.pics[1] || noImage);
                // shadow.querySelector('#div2').style.backgroundImage = url(this.pics[2] || noImage);
                // shadow.querySelector('#div3').style.backgroundImage = url(this.pics[3] || noImage);
                // shadow.querySelector('#div4').style.backgroundImage = url(this.pics[4] || noImage);
            },

            //Henery added//
            _addTags(e) {
                let myTags = this.shadowRoot.querySelector('#myTags');
                let val = this.shadowRoot.querySelector('#inputTags').value;
                console.log('Key Down', e);

                if (e.code === "Enter") {
                    myTags._addTag(val);
                    this.shadowRoot.querySelector('#inputTags').value = "";
                }
                //console.log("arrayResult:", myTags.tags);
            },

            ready: function() {
                console.log("Entered Ready");
                let loginUrl = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
                let shadow = this.shadowRoot;
                let loc = location.search;
                let pid = "";
                let posit = 0;
                for (i = 1; i < loc.length; i++) {
                    if (loc[i] == "u") {
                        posit = i;
                    };
                };
                for (a = 2; a < posit; a++) {
                    pid += loc[a];
                }
                this.id = pid;
                if (pid != "") {
                    /*Edit Product Code*/
                    let p = {
                        "action": "searchData",
                        "index": "change",
                        "type": "product",
                        "body": {
                            "query": {
                                "match": {
                                    "id": pid
                                }
                            }
                        }
                    };
                    console.log("RP", p);
                    Polymer.postData(loginUrl, p).then(res => {
                        console.log("RP", res);
                        if (res.code > 0) {
                            let res2 = res.resolve;
                            shadow.querySelector('#vs1').value = res.resolve[0]['categories'];
                            // shadow.querySelector('#public').checked = res.resolve[0]['isPublic'];
                            shadow.querySelector('#free').checked = res.resolve[0]['isFree'];
                            shadow.querySelector('#vs4').value = res.resolve[0]['isNew'];
                            shadow.querySelector('#pname').value = res.resolve[0]['productname'];
                            shadow.querySelector('#price').value = res.resolve[0]['price'];
                            console.log("Matters", res.resolve[0]['price']);
                            if (res.resolve[0]['price'] != "0") {

                                shadow.querySelector('#free').checked = false;
                            }
                            shadow.querySelector('#vs2').value = res.resolve[0]['district'];
                            shadow.querySelector('#vs3').value = res.resolve[0]['deliveryMethod'];
                            shadow.querySelector('#pdes').value = res.resolve[0]['description'];
                            shadow.querySelector('#myTags').tags = res.resolve[0]['tags'];
                            shadow.querySelector('#trans').value = res.resolve[0]['deliveryDesc'];
                            let lenpic = res2[0]['pics'].length;
                            for (i3 = 0; i3 < lenpic; i3++) {
                                shadow.querySelector('#div' + i3).style.backgroundImage = 'url(' + res2[0]["pics"][i3] + ')'
                            };
                        }
                    })
                    this.next = pid;
                } else {
                    /*Add Product Code*/
                    let params = {
                        "action": "searchData",
                        "index": "change",
                        "type": "product",
                        "body": {
                            "query": {
                                "match_all": {}
                            },
                        }
                    }
                    Polymer.postData(loginUrl, params).then(res => {
                        console.log(res);
                        if (res.code > 0) {
                            this.next = res.resolve.length;
                        }
                    });
                }

                this.valueArray = [""];
                let that = this;
                customElements.whenDefined('vaadin-select').then(function() {
                    const choice = [{
                        id: '車與地產',
                        name: '車與地產'
                    }, {
                        id: '潮流生活',
                        name: '潮流生活'
                    }, {
                        id: '家居生活',
                        name: '家居生活'
                    }, {
                        id: '興趣與遊戲',
                        name: '興趣與遊戲'
                    }, {
                        id: '工作與服務',
                        name: '工作與服務'
                    }, {
                        id: '其他服務',
                        name: '其他服務'
                    }];

                    const propage = [{
                        id: '専頁1',
                        name: '専頁1'
                    }, {
                        id: '専頁2',
                        name: '専頁2'
                    }, {
                        id: '専頁3',
                        name: '専頁3'
                    }, {
                        id: '専頁4',
                        name: '専頁4'
                    }, {
                        id: '専頁5',
                        name: '専頁5'
                    }, {
                        id: '専頁6',
                        name: '専頁6'
                    }];

                    const district = [{
                        id: '中西區',
                        name: '中西區'
                    }, {
                        id: '灣仔區',
                        name: '灣仔區'
                    }, {
                        id: '東區',
                        name: '東區'
                    }, {
                        id: '南區',
                        name: '南區'
                    }, {
                        id: '油尖旺區',
                        name: '油尖旺區'
                    }, {
                        id: '深水埗',
                        name: '深水埗區'
                    }, {
                        id: '九龍城區',
                        name: '九龍城區'
                    }, {
                        id: '黃大仙區',
                        name: '黃大仙區'
                    }, {
                        id: '觀塘區',
                        name: '觀塘區'
                    }, {
                        id: '葵青區',
                        name: '葵青區'
                    }, {
                        id: '荃灣區',
                        name: '荃灣區'
                    }, {
                        id: '屯門區',
                        name: '屯門區'
                    }, {
                        id: '元朗區',
                        name: '元朗區'
                    }, {
                        id: '離島區',
                        name: '離島區'
                    }, {
                        id: '北區',
                        name: '北區'
                    }, {
                        id: '大埔區',
                        name: '大埔區'
                    }, {
                        id: '沙田區',
                        name: '沙田區'
                    }, {
                        id: '西貢區',
                        name: '西貢區'
                    }];

                    const delmthod = [{
                        id: '順豐',
                        name: '順豐'
                    }, {
                        id: '面交',
                        name: '面交'
                    }, ]

                    const status = [{
                        id: '全新',
                        name: '全新'
                    }, {
                        id: '二手',
                        name: '二手'
                    }, ]

                    shadow.querySelector('#vs1').renderer = function(root) {
                        // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                        if (root.firstChild) {
                            return;
                        }
                        // Create the <vaadin-list-box>
                        const listBox = document.createElement('vaadin-list-box');
                        choice.forEach(function(item) {
                            const vaadinItem = document.createElement('vaadin-item');
                            vaadinItem.textContent = item.name;
                            listBox.appendChild(vaadinItem);
                            vaadinItem.setAttribute('value', item.id);
                        });
                        // update the content
                        root.appendChild(listBox);
                    };

                    shadow.querySelector('#pro').renderer = function(root) {
                        // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                        if (root.firstChild) {
                            return;
                        }
                        // Create the <vaadin-list-box>
                        const listBox = document.createElement('vaadin-list-box');
                        propage.forEach(function(item) {
                            const vaadinItem = document.createElement('vaadin-item');
                            vaadinItem.textContent = item.name;
                            listBox.appendChild(vaadinItem);
                            vaadinItem.setAttribute('value', item.id);
                        });
                        // update the content
                        root.appendChild(listBox);
                    };

                    shadow.querySelector('#vs2').renderer = function(root) {
                        // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                        if (root.firstChild) {
                            return;
                        }
                        // Create the <vaadin-list-box>
                        const listBox = document.createElement('vaadin-list-box');
                        district.forEach(function(item) {
                            const vaadinItem = document.createElement('vaadin-item');
                            vaadinItem.textContent = item.name;
                            listBox.appendChild(vaadinItem);
                            vaadinItem.setAttribute('value', item.id);
                        });
                        // update the content
                        root.appendChild(listBox);
                    };

                    shadow.querySelector('#vs3').renderer = function(root) {
                        // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                        if (root.firstChild) {
                            return;
                        }
                        // Create the <vaadin-list-box>
                        const listBox = document.createElement('vaadin-list-box');
                        delmthod.forEach(function(item) {
                            const vaadinItem = document.createElement('vaadin-item');
                            vaadinItem.textContent = item.name;
                            listBox.appendChild(vaadinItem);
                            vaadinItem.setAttribute('value', item.id);
                        });
                        // update the content
                        root.appendChild(listBox);
                    };

                    shadow.querySelector('#vs4').renderer = function(root) {
                        // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                        if (root.firstChild) {
                            return;
                        }
                        // Create the <vaadin-list-box>
                        const listBox = document.createElement('vaadin-list-box');
                        status.forEach(function(item) {
                            const vaadinItem = document.createElement('vaadin-item');
                            vaadinItem.textContent = item.name;
                            listBox.appendChild(vaadinItem);
                            vaadinItem.setAttribute('value', item.id);
                        });
                        // update the content
                        root.appendChild(listBox);
                    };
                });


                let user = store.get('change-user');
                console.log("User hoon main", user['_id']);
                shadow.querySelector('#owner').innerHTML = user['username'];

                if (user['head'] == "") {
                    shadow.querySelector('#a1').innerHTML = '<img id="gand" src="http://change.dazzle.website/img/user_profile.png">';
                } else {
                    shadow.querySelector('#a1').innerHTML = '<img id="gand" src=' + user['head'] + '>';
                };
                console.log("SEE", shadow.querySelector('#gand').src);
                //check the username     

                shadow.querySelector('#free').addEventListener("click", (e) => {
                    console.log("worked");
                    if (shadow.querySelector('#free').checked == true) {
                        console.log('Price will be disabled');
                        shadow.querySelector('#price').disabled = true;
                        shadow.querySelector('#price').value = "0";
                    } else if (shadow.querySelector('#free').checked == false) {
                        console.log('Price will be enabled');
                        shadow.querySelector('#price').disabled = false;
                    }
                })


            },
            getAllPics() {
                let shadow = this.shadowRoot;
                this.pics = [];
                shadow.querySelectorAll('.productImg').forEach(item => {
                    let src = item.style.backgroundImage;
                    src = src.replace('url(', '').replace(')', '').replace(/\"/gi, "");
                    console.log('Src', src);
                    this.pics.push(src);
                });
            },
            _saveData: function() {
                let user = store.get("change-user") || null;
                let temptime = Date.now();
                let tempid = user['_id'];
                if (location.search.length < 3) {
                    var thenewid = "" + temptime.toString() + tempid;

                } else {
                    var thenewid = this.id;

                }

                if (user != null) {
                    console.log(user);
                    let that = this;
                    let shadow = this.shadowRoot;
                    //Get value from select box categories
                    var myselect = shadow.querySelector("#vs1");
                    var categories = myselect.value;
                    console.log("Category:", categories);
                    // let public = shadow.querySelector('#public').checked;
                    // console.log("Public:", public);
                    let free = shadow.querySelector('#free').checked;
                    console.log("Free:", free);
                    let pname = shadow.querySelector('#pname').value;
                    console.log("Productname:", pname);
                    let price = shadow.querySelector('#price').value;
                    console.log("Price:", price);
                    //Get value from select box district
                    var myselect = shadow.querySelector("#vs2");
                    var district = myselect.value;
                    console.log("District:", district);
                    //Get value from select box district
                    var myselect = shadow.querySelector("#vs3");
                    var method = myselect.value;
                    console.log("Method:", method);
                    let pdes = shadow.querySelector('#pdes').value;
                    console.log("Productdescription:", pdes);
                    //.tags is refering to the arrayValue
                    let tags = shadow.querySelector('#myTags').tags;
                    console.log("Tags:", tags);
                    let deldes = shadow.querySelector('#trans').value;
                    console.log("DeliveryDescription:", deldes);

                    //Get value from select box NewOld
                    var myselect = shadow.querySelector("#vs4");
                    var newOld = myselect.value;
                    console.log("New/Old:", newOld);
                    this.getAllPics();
                    console.log('Photo', this.pics);
                    if (newOld == "二手") {

                        var no = Boolean(0);
                        console.log('Used', no);
                    } else {

                        var no = Boolean(1);
                    }
                    let x = 0;
                    let Url = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";

                    console.log("X", this.next);
                    let loc = location.search;
                    console.log("Path", loc);
                    console.log("Length", loc.length);
                    let id = "";
                    for (var i = 1; i < loc.length; i++) {
                        console.log("Working");
                        id += loc[i];
                    }
                    console.log("ID", id);
                    if (id == "") {
                        this.next++;
                    }
                    let json = {
                        "categories": categories,
                        // "isPublic": public,
                        "isFree": free,
                        "productname": pname,
                        "price": parseFloat(price),
                        "district": district,
                        "deliveryMethod": method,
                        "description": pdes,
                        "tags": tags,
                        "deliveryDesc": deldes,
                        "isNew": no,
                        "ownerId": user['_id'],
                        "id": thenewid,
                        "createTime": Date.now(),
                        "pics": this.pics,
                        "like": 0
                    }
                    let params = {
                        "action": "addData",
                        "index": "change",
                        "type": "product",
                        "id": thenewid,
                        "body": json
                    };
                    console.log("JSON", params);
                    Polymer.postData(Url, params).then(res => {
                        console.log("Result", res);
                        if (res.code > 0) {
                            alert("success!");
                        } else {
                            alert("Failed");
                        }
                    })

                    // this.fileManager.saveFile('json/product-14.json',json);
                } else {
                    alert("Please login first");
                }


            },

            _uploadFile: function(e) {
                console.log('upload', e);
                let shadow = this.shadowRoot;
                let that = this;
                this.pics = [];
                let dialog = shadow.querySelector('vaadin-dialog');
                this.dialog = dialog;
                this.curElm = e.path[0];

                // Polymer.popup(dialog, "change", "change-dropzone-file", "60%", "50%");
                Polymer.popup(dialog, 'change', 'change-gallery', '90%', '90%');
                // console.log('saved', bucket)
            },

            closeDialog() {
                // let dialog = shadow.querySelector('vaadin-dialog');
                this.dialog.opened = false;
            }
            // _disablePrice: function () {
            //     console.log('free now');
            //     let shadow = this.shadowRoot;
            //     let that = this;
            //     if (shadow.querySelector('#free').checked == true) {
            //         console.log('Price disabled');
            //         shadow.querySelector('#price').setEnabled(false);
            //         shadow.querySelector('#price').value = "0";
            //     } else if (shadow.querySelector('#free').checked == false) {
            //         console.log('Price enabled');
            //         shadow.querySelector('#price').setEnabled(true);
            //     };
            // }


        });
    })();
</script>