import { PolymerElement, html } from '/node_modules/@polymer/polymer/polymer-element.js';
// import {Dazzle} from '/node_modules/@dazzle/dz-dazzle/dz-library.js';

// import '/node_modules/@dazzle/dz-dazzle/css/main-style.js';


class dzElm extends PolymerElement {
  static get properties () {
    return {
        "id": {
            "type": String
        },
        "removeid": {
            "type": String
        }
    };
  }
constructor(){
    super();
    this.dataManager = new DataPackage("product");
}
  ready() {
      super.ready();
      let that = this;
      let shadow = this.shadowRoot;

      //Eventlistener for the switch button
      let cStatus = shadow.querySelector('.status');
      cStatus.addEventListener('click', e => {
          that.upStock();
      });

      //Get back status for switch button from Postman
      let loc = location.search;
      let pid;
      if(window.location.hash)
        pid = window.location.hash.substring(1);
    else
        pid = document.head.querySelector('meta[name=product-id]').getAttribute('content');

        this.id = pid;


      this.dataManager.getDataByCache(pid).then(res=>{
          if (typeof(res.postStatus) == "undefined") {
              res['postStatus'] = true;
              shadow.querySelector('.status').checked = true;
              this.dataManager.saveDataWithCache(pid,res);
          } else 
              shadow.querySelector('.status').checked = res.postStatus;

          this.product = res;
      });

}
   //UP & DOWN FUNCTION
   upStock() {
    let shadow = this.shadowRoot;
    let check = shadow.querySelector('.status').checked;
    try {
        if (check && this.product['isExchange']){
            alert('你的貨品在交換區使用中，不能即時上架。請等候回覆，或取消交換交易');
            return;
        }

    } catch(e){

    }

    this.product['postStatus'] = check;
    this.product['isExchange'] = false;
console.log('Status',this.id,this.product);
    this.dataManager.saveDataWithCache(this.id,this.product);
}

  static get template () {
    // Template getter must return an instance of HTMLTemplateElement.
    // The html helper function makes this easy.
    return html`
    <style>
    .status-container {
        color: white;
        font-family: sans-serif, Microsoft JhengHei;
        margin: 0;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 35px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: -5;
        left: 0px;
        t: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
        padding: 0px;
        /* padding-left: 0px; */
        border: solid 1px #ccc;
        width: auto;
        margin: 0px;
    }

    .slider span {
        color: white;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 35px;
        width: 48px;
        left: 2px;
        bottom: 0px;
        background-color: white;
        -webkit-transition: .4s;
        transition: .4s;
        top: 0px;
    }

    input:checked+.slider {
        background-color: green;
    }

    input:focus+.slider {
        box-shadow: 0 0 1px green;
    }

    input:checked+.slider:before {
        -webkit-transform: translateX(45px);
        -ms-transform: translateX(45px);
        transform: translateX(45px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

    .slider.round:before {
        border-radius: 50%;
    }

    @media only screen and (max-width: 640px) {
        .switch{
            width: 80px;
        }

        .slider {
            padding-top: 5px;
            padding-left: 5px;
            font-size: 14px;
        }

        .slider:before {
            width: 38px;
        }

        input:checked+.slider:before {
            transform: translateX(36px);
        }
    }
</style>

<div class="status-container">
    <label class="switch">
        <input class="status" type="checkbox" checked>
        <span class="slider">上架 | 下架</span>
    </label>
</div>
    `;
  }
}

// Register the element with the browser.
customElements.define('change-status', dzElm);

