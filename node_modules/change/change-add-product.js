import { PolymerElement, html } from '/node_modules/@polymer/polymer/polymer-element.js';
import '/node_modules/@vaadin/vaadin-dialog/vaadin-dialog.js';
import {Dazzle} from '/node_modules/@dazzle/dz-dazzle/dz-library.js';

import "/node_modules/@vaadin/vaadin-checkbox/vaadin-checkbox.js";
import "/node_modules/@vaadin/vaadin-select/vaadin-select.js";
import "/node_modules/@vaadin/vaadin-text-field/vaadin-text-field.js";
import "/node_modules/@vaadin/vaadin-text-field/vaadin-number-field.js";
import "/node_modules/@vaadin/vaadin-text-field/vaadin-text-area.js";
import "/node_modules/@cwmr/paper-tags-input/paper-tags-input.js";
import "/node_modules/@vaadin/vaadin-menu-bar/vaadin-menu-bar.js";

import "./change-inform.js";
import "/node_modules/@dazzle/dz-dazzle/css/main-style.js";


class dzElm extends PolymerElement {
    static get properties() {
        return {
            id:{
                "type":String
            },
            valueArray:{
                type: Array
            },
            product: {
                type: Object,
                value: function() {
                    return {};
                }
            },
            owner: {
                type: Object,
                value: function() {
                    return {};
                }
            }
        }
    }

    // Observe the name sub-property on the user object
    static get observers() {
        return [
            'productNameChanged(product.productname)'
        ]
    }

    
    productNameChanged(name) {
        console.log('Change');
        if (name) {
        console.log('new name: ' + name);
        } else {
        console.log('name is undefined');
        }

    }
    
    
    checkAlias(){
        if (!this.product['alias']) {
            console.log('Check Alias',this.product);
            this.changeAlias(this.product['productname']);
        } else {
            console.log('Check Alias',this.product);
            return;
        }
    }
    _changeAlias(){
        this.changeAlias(this.product['productname']);
    }

    changeAlias(name){
        let that = this;
        console.log('Alias',name);
        this.fileManager.listFile('product/'+name).then(res=>{
            console.log('Alias',res.length,name);
            if (res.length === 0) {
                that.product['alias'] = name;
                that.product['productname'] = name;
                console.log('Change Alias',that.product);

                // this.saveProductPage();
            } else{
                let name2 = prompt('貨品名稱已被使用，請再填一個吧',name);
                if (!name2)
                    return;
                that.changeAlias(name2);
            }
        });          
    }

    constructor() {
        super();
        let user = store.get('change-user') || null;
        if (!user){
            alert("請先登入");
            location.href = "/index.html";
        } else
            this.fileManager = new AwsPackage(user);


        console.log('Add Product',this.product);
        // if (!this.user)
        //     this.user = user;
        let shadow = this.shadowRoot;
        this.bigPic = "http://change.dazzle.website.s3.amazonaws.com/files/1/1591944377549.jpeg";
        this.pics = [];
        this.pics[0] = this.bigPic;
        this.dataManager = new DataPackage('product');
        this.userManager = new DataPackage('_user');
        // this.fileManager = new AwsPackage(user);
//                this.owner = store.get('product-owner');
//                console.log('Who am I?(Constructor) ',this.owner,this.isFan);            
        // if (this.myOwner)
        //     this.owner = this.myOwner;
        
      
        this.fileManager.listFile('product/').then(res=>{
            this.noProduct = res.length+1;
        });

        //CREATED ENDS HERE//
    }

    reAlias(i){
        let alias = this.product['productname'];
        alias = alias.replace(/^\s+|\s+$/gm,'')
        alias = alias.replace(/ /gm,'-');
        alias = alias.replace(/\//gm,'-');
        if (i>0)
            alias = alias+'-'+i;
        this.dataManager.matchData({"alias":alias}).then(res=>{
            if (!res.length)
                this.product['alias'] = alias;                    
            else{
                i++;
                this.reAlias(i);
            }
            console.log('Change Alias',res,res.length);
        });
    }

    generateNewId(){
        let no = new Date().getTime() % 10000;
        let str; 
        let that = this;
        this.fileManager.listFile('product/').then(res=>{
            this.product['id'] = String(no) + String(res.length +1);
        });
    }


    reNewPic(src) {
        let shadow = this.shadowRoot;
        let noImage = './img/1200px-No_image_3x4.svg.png';
        let i = 0;
        this.pics.forEach(item => {
            shadow.querySelector('#div' + i).style.backgroundImage = 'url(' + this.pics[i] || noImage + ')';
            i++;
        });

    }

    //Henery added//
    _addTags(e) {
        let myTags = this.shadowRoot.querySelector('#myTags'); 
        let val = this.shadowRoot.querySelector('#inputTags').value;
        console.log('Key Down', myTags.tags);

        if (e.code === "Enter") {
            myTags.addTag(val);
            this.shadowRoot.querySelector('#inputTags').value = "";
            this.product.tags = myTags.tags;
        }
        //console.log("arrayResult:", myTags.tags);
    }

    newProduct(){
        let model =  {
                "categories": "",
                "sellerMsg": "",
                "productname": "",
                "price": 10,
                "district": "",
                "deliveryMethod": "面交",
                "descrip": "",
                "tags": [],
                "deliveryDesc": "",
                "isNew": true,
                "isFree": false,
                "ownerId": null,
                "pics": ["http://change.dazzle.website.s3.amazonaws.com/files/1/1591944377549.jpeg"],
                'alias': '',
                "postStatus":false,
                "isPurchase": false
        };


        if (this.product != null){
            console.log('Edit Product',this.product);
            this.mode = 'edit';
            this.initProduct();
        } else {
            console.log('Add Product',this.product);
            this.product = model;
            let user = store.get('change-user') || null;
            if (!this.isFan)
                this.product['ownerId'] = user['id'];
            else 
                this.product['ownerId'] = this.owner['id'];
            this.generateNewId();
            this.mode = 'add';
            this.initProduct();
        }






        
    }

    initProduct(){


        
//edit mode
        //     let res;                   
        // res = this.product;
        console.log('Product',this.product);
        this.bigPic = this.product.pics[0] || "https://www.gettv.hk/img/nopic.png";
        this.pic1 = this.product.pics[1] || "https://www.gettv.hk/img/nopic.png";
        this.pic2 = this.product.pics[2] || "https://www.gettv.hk/img/nopic.png";
        this.pic3 = this.product.pics[3] || "https://www.gettv.hk/img/nopic.png";
        this.pic4 = this.product.pics[4] || "https://www.gettv.hk/img/nopic.png";
        if (!this.price)
           this.price = 10;

        if (this.product['isFree'])
            this.shadowRoot.querySelector('#price').disabled = true;
        this.userManager.getDataByCache(this.product['ownerId']).then(res=>{this.owner = res;});    
        this.product['isPurchase'] = false;
        

    }

    ready() {
        super.ready();
        
        let user = store.get('change-user') || null;
        this.user = user;
        let that = this;
        let shadow = this.shadowRoot;
        let loc = location.search;
        let pid = this.id;
        let posit = 0;
        let uid = "";
        let res = this.product;
        let myTags = this.shadowRoot.querySelector('#myTags');  

        // for (i = 2; i < loc.length; i++) {
        //     pid += loc[i]
        // };
        // pid = document.head.querySelector('meta[name=product-id]').getAttribute('content') || null;
        console.log('PID',pid);

        // if (this.mode==="edit") {
        
        // } else {
        //     //add mode
        //     this.prodprice = '10';
        //     this.owner = this.user;
        // }

        // this.userManager.getDataByCache()

//                console.log('Who am I? ',this.owner,this.isFan);     
      
      try{
        this.newProduct();
        this.vaadin_select();

        // that.fanpage();
        this.submenu();

      } catch(e){
          console.log('Error',e);
          alert('技術問題, 不能新增貨品, 請聯絡管理員');
      }


        // this.$.fans.render();
        // this.$.ownerPanel.render();  

        // if (this.myOwner)
        //     this.owner = this.myOwner;


        //ENABLE & DISABLE PRICE
        shadow.querySelector('#free').addEventListener("click", (e) => {
            if (shadow.querySelector('#free').checked == true) {
                shadow.querySelector('#price').disabled = true;
                shadow.querySelector('#price').value = 0;
            } else if (shadow.querySelector('#free').checked == false) {
                shadow.querySelector('#price').disabled = false;
            }
        });

        shadow.querySelector('#vs4').addEventListener('change',e=>{
            console.log('Value',e.target.value);
            switch(e.target.value){
                case '全新':
                    this.product.isNew = true;
                break;

                case '二手':
                    this.product.isNew = false;
                break;
            }
        });
        // Add image selected function 
        shadow.querySelectorAll('.productImg').forEach(item=>{
            item.selected = function(url,originUrl,smallUrl){
                item.style.backgroundImage = 'url(' + url + ')';
                Dazzle.activeElement = null;
                shadow.querySelector('vaadin-dialog').opened = false;
                let index = parseInt(item.getAttribute('data-id'));
                that.product['pics'][index] = url;

            }
        });

        // shadow.querySelector('#pname').addEventListener('blur',e=>{
        //     let name = e.target.value;
        //     console.log('Name',name);
        //     this.product['productname'] = name;
        //     this.product['alias'] = name;
        //     this.changeAlias(name);
        // });

    }


    getAllPics() {
        let shadow = this.shadowRoot;
        this.pics = [];
        shadow.querySelectorAll('.productImg').forEach(item => {
            let src = item.style.backgroundImage;
            src = src.replace('url(', '').replace(')', '').replace(/\"/gi, "");
            console.log('Src', src);
            this.pics.push(src);
        });
    }

    dataPostProcess(){
        let myTags = this.shadowRoot.querySelector('#myTags');
        this.product['tags'] = myTags.tags;
        console.log('Product',this.product);

    }

    condition(){

        console.log('Condition',this.product);
        try {
            if (!this.product.categories) {
                alert('未填分類');
                return false;
    
            }
            
            if (!this.product.productname) {
                alert('未填產品名');
                return false;
            }
    
            if (!this.product.tags.length) {
                alert('未有標籤');
                return false;
            }
        
        } catch(e){
            alert('未明原因. 未能儲存');
            return false;
        }

        return true;
    }
    _cancel(){
        this.dialog.opened = false;
    }
    _saveData() {
        console.log('Product',this.product);
        let myTags = this.shadowRoot.querySelector('#myTags');
        this.product.tags = myTags.tags || [];

        if (!this.condition())
            return false;
        
        let that = this;
        let shadow = this.shadowRoot;
        // shadow.querySelector('#save').innerHTML = '上存中...';

        this.product['postStatus'] = false;
        this._save();            
        this.saved = true;
        alert('已儲存為下架貨品, 若要出售，請點擊發佈');
    }
    
    _publish(){
        if (!this.condition())
            return false;
        this.product['postStatus'] = true;
        this._save();
        alert('已發佈');
        this.dialog.opened = false;
    }
    _uploadFile(e) {
        let shadow = this.shadowRoot;
        let that = this;
        let elm = e.target;
        this.pics = [];
        let dialog = shadow.querySelector('vaadin-dialog');
        this.dialog = dialog;
        this.curElm = e.path[0];
        Dazzle.activeElement = elm;
        Dazzle.loadComponent('dz-file-management','dz-sub-img-stock');
        let dzPopup = document.createElement('dz-sub-img-stock');
        dzPopup.subUserId = this.user['id'];
        dzPopup.subUser = this.user;
        dzPopup.dialog = this.shadowRoot.querySelector('vaadin-dialog');
        dzPopup.select = function(){
            elm.style.backgroundImage = 'url('+dzPopup.selected+')';
            this.dialog.opened = false;
        }
        Dazzle.componentPopup(dzPopup,'90%','90%');

        // Dazzle.popup(dialog, 'change', 'change-gallery', '90%', '90%');
        // console.log('saved', bucket)
    }

    closeDialog() {
        // let dialog = shadow.querySelector('vaadin-dialog');
        this.dialog.opened = false;
    }
    saveProductPage(){
        let that = this;
            let html = document.createElement('html');
            let head = document.createElement('head');
            let body = document.createElement('body');

            let meta = document.createElement('meta');
            meta.setAttribute('name','product-id');
            meta.setAttribute('content',this.product['id']);
            Dazzle.getContent('/product.html').then(content=>{
                let parser = new DOMParser();
                let doc = parser.parseFromString(content, "text/html");
            
                head.innerHTML = doc.head.innerHTML;
                body.innerHTML = doc.body.innerHTML;
                // body.innerHTML = 
                console.log('HTML',head.innerHTML,body.innerHTML);

                head.appendChild(meta);
                html.appendChild(head);
                html.appendChild(body);
                console.log('Save Product',this.product);
                // this.dataManager.saveData(this.id,this.product);
                // this.fileManager.saveUserData('json/product-'+this.id+'.json',JSON.stringify(this.product));
                let fileManager = new AwsPackage(this.user);
                fileManager.saveHtml('product/'+this.product['alias'],html.outerHTML);
            });
    }
    _save(){
        // this.checkAlias();
        console.log('Product',this.product);

        // Re Alias and save Product Page
        let alias = this.product['productname'];
        alias = alias.replace(/^\s+|\s+$/gm,'')
        alias = alias.replace(/ /gm,'-');
        alias = alias.replace(/\//gm,'-');
        alias = alias+'-'+ this.noProduct;
        this.product['alias'] = alias;
        this.product['createTime'] = new Date().getTime();
        
        this.dataManager.saveDataWithCache(this.product['id'],this.product).then(res=>{
            if (this.mode=="add")
                this.addUserGoods(this.product['ownerId']);
            this.saveProductPage();
            console.log('Product',this.product);

//            Dazzle.loadComponent('change','change-inform');
//            let dzPopup = document.createElement('change-inform');
//            dzPopup.msg = "成功儲存";
//            dzPopup.dialog = this.shadowRoot.querySelector('vaadin-dialog');
//            Dazzle.componentPopup(dzPopup,'300px','200px');

             alert('成功儲存');
            // location.href="/getchange.html";
        });
    }
    addUserGoods(uid){
        let userManager = new DataPackage("_user");
        let that = this;
        this.userManager.getDataByCache(uid).then(res=>{
            res['goodsNum']++;
            that.userManager.saveDataWithCache(uid,res);
        });
    }

    vaadin_select() {
        let shadow = this.shadowRoot;
        //SET AREA, DERLIVER METHOD, PRODUCT STATUS//
        this.valueArray = [""];
        customElements.whenDefined('vaadin-select').then(function() {
            const district = [{
                name: '中西區'
            }, {
                name: '灣仔區'
            }, {
                name: '東區'
            }, {
                name: '南區'
            }, {
                name: '油尖旺區'
            }, {
                name: '深水埗區'
            }, {
                name: '九龍城區'
            }, {
                name: '黃大仙區'
            }, {
                name: '觀塘區'
            }, {
                name: '葵青區'
            }, {
                name: '荃灣區'
            }, {
                name: '屯門區'
            }, {
                name: '元朗區'
            }, {
                name: '離島區'
            }, {
                name: '北區'
            }, {
                name: '大埔區'
            }, {
                name: '沙田區'
            }, {
                name: '西貢區'
            }];

            const delmthod = [{
                name: '面交'
            }, {
                name: '運送'
            }, {
                name: '面交或運送'
            }];

            const status = [{
                name: '全新'
            }, {
                name: '二手'
            }];


            //AREA//
            shadow.querySelector('#vs2').renderer = function(root) {
                // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                if (root.firstChild) {
                    return;
                }
                // Create the <vaadin-list-box>
                const listBox = document.createElement('vaadin-list-box');
                district.forEach(function(item) {
                    const vaadinItem = document.createElement('vaadin-item');
                    vaadinItem.textContent = item.name;
                    listBox.appendChild(vaadinItem);
                    vaadinItem.setAttribute('value', item.name);
                });
                // update the content
                root.appendChild(listBox);
            };

            //DELIVER METHOD//
            shadow.querySelector('#vs3').renderer = function(root) {
                // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                if (root.firstChild) {
                    return;
                }
                // Create the <vaadin-list-box>
                const listBox = document.createElement('vaadin-list-box');
                delmthod.forEach(function(item) {
                    const vaadinItem = document.createElement('vaadin-item');
                    vaadinItem.textContent = item.name;
                    listBox.appendChild(vaadinItem);
                    vaadinItem.setAttribute('value', item.name);
                });
                // update the content
                root.appendChild(listBox);
            };

            //PRODUCT STATUS//
            shadow.querySelector('#vs4').renderer = function(root) {
                // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                if (root.firstChild) {
                    return;
                }
                // Create the <vaadin-list-box>
                const listBox = document.createElement('vaadin-list-box');
                status.forEach(function(item) {
                    const vaadinItem = document.createElement('vaadin-item');
                    vaadinItem.textContent = item.name;
                    listBox.appendChild(vaadinItem);
                    vaadinItem.setAttribute('value', item.name);
                });
                // update the content
                root.appendChild(listBox);
            };
        });

    }


    fanpage() {
        let shadow = this.shadowRoot
        let that = this;
        let parampage = {
            "action": "searchData",
            "index": "change",
            "type": "_user",
            "_source": "pagename",
            "body": {
                "query": {
                    "match": {
                        "adminId": this.user['id']

                    }
                }
            }
        };
        let loginUrl = "https://41khtanrje.execute-api.ap-northeast-1.amazonaws.com/prod/Dazzle-elasticSearchController";
        console.log("fanpage json", JSON.stringify(parampage));
        Dazzle.postData(loginUrl, parampage).then(res => {
            // console.log("BBB", usertokenId);
            if (res.code > 0) {
                console.log('all fanpage,res.resolv', res.resolve);
                let pagename = [];
                res.resolve.forEach(item => {
                    pagename.push({
                        id: item['_id'],
                        name: item['pagename']
                    })
                });
                if (res.resolve.length == 0) {
                    pagename.push({
                        name: "沒有專頁可以選擇",
                        id: "#$%!@&^(ntw"
                    });

                }
                customElements.whenDefined('vaadin-select').then(function() {
                    const propage = pagename;
                    shadow.querySelector('#fanPage').renderer = function(root) {
                        // Check if there is a list-box generated with the previous renderer call to update its content instead of recreation
                        if (root.firstChild) {
                            return;
                        }
                        // Create the <vaadin-list-box>
                        const listBox = document.createElement('vaadin-list-box');
                        propage.forEach(function(item) {
                            const vaadinItem = document.createElement('vaadin-item');
                            vaadinItem.textContent = item.name;
                            listBox.appendChild(vaadinItem);
                            vaadinItem.setAttribute('value', item.id);
                        });
                        // update the content
                        root.appendChild(listBox);
                    };
                });

            } else {
                alert("u");
            }
        })

    }
    submenu() {
        let shadow = this.shadowRoot;
        let that = this;
        customElements.whenDefined('vaadin-menu-bar').then(function() {
            const menu = shadow.querySelector('vaadin-menu-bar');
            // menu.items = [
            //     {
            //         text: 'Project',
            //         children: [
            //         {text: 'Users',
            //             children: [{text: 'List'}, {text: 'Add'}]
            //         },
            //         {text: 'Billing',
            //             children: [{text: 'Invoices'}, {text: 'Balance Events'}]
            //         },
            //         ]
            //     },
            //     {
            //         text: 'Account',
            //         children: [
            //         {text: 'Edit Profile'},
            //         {text: 'Privacy Settings'}
            //         ]
            //     },
            //     {text: 'Sign Out'}
            // ];

            menu.addEventListener('item-selected', function(e) {
                // this.prod.categories = e.detail.value.text;
                // this.CATE = e.detail.value.text;
                that.product.categories = e.detail.value.text;
                that.notifyPath('product.categories');
                // shadow.querySelector('span').textContent = e.detail.value.text;
                // this.CATE = e.detail.value.text;
            });

            let c = {};
            let arr = [];
            let g = [];
            let childarr = [];

            // let catManager = new DataPackage('categories');
          
            Dazzle.getUserDataContent('json/category.json').then(content=>{
                let json = JSON.parse(content);
                console.log('JSON',json);
                json.forEach(item=>{
                    let cat; 
                    let subArr=[];
                    item.children.forEach(subcat=>{
                        subArr.push({
                           'text':subcat
                        });
                    });
                    cat = {
                        'text':item.name,
                        'children':subArr
                    }
                    arr.push(cat);
                });
                let h = {
                    text: '請選擇分類',
                    children: arr
                };
                menu.items = [h];
            });
        });

    }
    textchange(test) {
        this.shadowRoot.querySelector('#save').innerHTML = '發佈上架';
        alert(test);
    }


  static get template () {
    // Template getter must return an instance of HTMLTemplateElement.
    // The html helper function makes this easy.
    return html`
    <style include="main-style"></style>

 <style>
            .inputbox{
                padding:0px 5px;
            }
            *,
            p,
            span {
                color: black;
                font-family: sans-serif, Microsoft JhengHei;
            }

            /* SUBCAT */
            .container {
                display: display;
                margin-top: 13px;
            }

            span {
                color: black;
                font-family: sans-serif, Microsoft JhengHei;
            }

            .result,
            span {
                margin: 9px 2px 0px 2px;

            }

            vaadin-menu-bar::part(container) {
                color: #ccc;
            }

            vaadin-menu-bar::part(menu-bar-button) {
                width: 150px;
            }

            /* SUBCAT */

            hr {
                max-width: 100px;
                margin-left: 0;
                margin-bottom: 10px;
            }

            ul {
                display: flex;
                margin-bottom: 0px;
            }

            li {
                list-style: none;
            }

            #gand {
                border-radius: 9999999999px;
            }

            .top-banner {
                margin-right: 1%;
                background: #FFE9BF;
                background-repeat: no-repeat;
                background-size: contain;
                height: 100%;
            }

            #banner3 {
                width: 100%;
                height: auto;
                display: block;
            }

            .change-new-product-container {
                display: grid;
                grid-template-columns: 1fr 0.8fr;
                height: auto;
                margin: 0 auto;
                background: white;
                width: 92.5%;
                border: solid 1px #ccc;
            }

            header {
                background-image: url("https://www.gettv.hk/img/background/3.jpg");
                padding-top: 30px;
                height:auto !important;
            }

            #tbar {
                display: flex;
                justify-content: space-between;
                border: 1px solid #ccc;
                padding-top: 15px;
                padding-bottom: 20px;
                background: #F0F0F0;
                margin: 0 auto;
                width: 92.5%;
            }

            .custom-select select {
                width: 120px;
                padding: 3px;

            }

            #first {
                padding: 5px;
                margin-right: 25px;
            }

            :host([theme~="custom"][checked]) [part="checkbox"] {
                background-color: green;

            }

            #firstlabel {
                margin-right: 25px;
                margin-top: 22px;
                margin-left: 50px;
            }

            #secondlabel {
                margin-top: 22px;
                margin-left: 25px;
            }

            button {
                cursor: pointer;
            }

            .first {
                margin-right: 30px;
            }

            .buttons button {
            }

            #upload {
                border-radius: 0;
                padding: 8px;
                float: right;
                margin-top: 30px;
                min-block-size: fit-content;
                border: 1px solid #ccc;
                width: 22%;
                height: 40px;
                background-color: white;
            }

            .u {
                margin-right: 0;
            }



            button {
                background-color: grey;
                width: 100px;
                height: 45px;
                border-radius: 3px;
                color: white;
                border: none;
                font-size: 20px;
                margin-right:20px;
            }

            #post {
                background-color: #ff8262;
                padding: 10px 20px;
                border: none;
                color: white;
            }

            .outer {
                margin: 0;
                width: 100%;
                background-image: url("https://www.gettv.hk/img/background/3.jpg");
                padding-bottom: 50px;
            }

            .left-pics {
                border-right: none;
                padding: 50px 10% 0 10%;
                height: auto;
                width: 80%;
            }

            .right-product {
                padding-top: 50px;
                height: auto;
                padding-bottom: 50px;
            }

            .bigPic,
            #div0 {
                height: 450px;
                background-image: url('https://www.gettv.hk/img/nopic.png');
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center center;
                border: 1px solid #ccc;
            }


            .consmall {
                display: grid;
                grid-template-columns: 22% 22% 22% 22%;
                grid-column-gap: 4%;
                margin-top: 30px;
                height: 100px;
            }

            #div1,
            #div2,
            #div3,
            #div4 {
                height: 95%;
                background-image: url('https://www.gettv.hk/img/nopic.png');
                background-size: 100%;
                background-repeat: no-repeat;
                background-position: center center;
                border-style: solid;
                border: 1px solid #ccc;
                margin-top: 2px;

            }

            .fullWidth {
                width: 100%;
                margin-bottom: 10px;
                display: flex;
            }

            .sellerContact {
                margin-top: 40px;
                margin-bottom: 20px;
            }

            #sContact {
                resize: none;
                overflow: hidden;
                width: 99%;
                margin-top: 15px;
                border: 1px #ccc solid;
            }

            input[type=text],
            input[type=number] {
                padding: 10px 21px;
                margin-left: 15px;
                display: inline-block;
                border: 1px solid #ccc;
                border-radius: 4px;
                box-sizing: border-box;
            }

            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            #pname {
                width: 80%;
            }

            #price {
                width: 63%;
            }

            #pdes {
                resize: none;
                overflow: hidden;
                width: 83.5%;
                border: 1px #ccc solid;
            }

            #trans {
                resize: none;
                overflow: hidden;
                width: 83.5%;
                border: 1px #ccc solid;
                margin-bottom: 30px;
            }

            #usericon {
                display: flex;
            }

            #a1 {
                display: inline-block;
                font-size: 15px;
            }

            #a2 {
                display: inline-block;
                font-size: 15px;
                margin-left: 5px;
            }

            #a1 img {
                width: 40px;
                height: 40px;
                border-radius: 9999999999999px;
            }

            #cs1 {
                width: 60px;
                height: 38px;
                padding: 5px;
                font-size: 13px;
            }

            #cs1 option {
                font-size: 13px;
            }

            .checked {
                color: orange;
            }

            .userinfo {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
            }

            .hkd {
                margin-top: 30px;
                margin-bottom: 20px;
            }

            .loca {
                margin: 20px 0 20px 0;
            }

            .del {
                margin-bottom: 20px;
            }

            #edit {
                width: 90px;
                height: 35px;
                border: 1px solid #ccc;
                background-color: white;
            }

            #location {
                width: 30px;
                height: 30px;
                background-image: url('https://www.gettv.hk/img/icon/location.png');
                background-size: cover;
                display: inline-block;
                margin-top: 15px;
            }

            #delivery {
                width: 30px;
                height: 30px;
                background-image: url('https://www.gettv.hk/img/icon/delivery.png');
                background-size: cover;
                display: inline-block;
                margin-top: 15px;
            }


            .bigsize {
                font-size: 25px;
                background-image: url(./img/);
                margin-top: 70px;
            }

            .tag {
                display: inline-block;
                margin-top: 10px;
            }

            .clearfix {
                display: flex;
            }

            .fanpage {
                margin-top: 11px;
                margin-left: 25px;
            }

            .tbar {
                display: grid;
                margin-left: 25px;
                grid-template-columns: 300px auto 100px 150px;
            }

            .outer {
                margin: 0;
                width: 100%;
                background-image: url("https://www.gettv.hk/img/background/3.jpg");
                padding-bottom: 50px;
            }

            @media only screen and (max-width: 768px) {
                .change-new-product-container {
                    display: grid;
                    grid-template-columns: 100%;
                    margin-bottom: 100px;

                }

                .fanpage {
                    margin-top: 5px;
                    margin-left: 2px;
                }

                #secondlabel {
                    margin-top: 22px;
                    margin-left: 0px;
                }

                .left-pics {
                    border-right: none;
                    padding: 5px 10px 0 10px;
                    height: auto;
                    width: auto;
                }

                .tbar {
                    display: block;
                    margin-left: 10px;
                }

                .right-product {
                    padding-top: 50px;
                    height: auto;
                    padding-left: 13px;
                    padding-bottom: 50px;
                }

                .bigPic {
                    height: 300px;
                }
            }
            #cancel{
                background:white;
                color:black;
            }

            #save{
                background-color:#F0846C;
                color:white;
            }

            #publish{
                background-color:#4CAF50;
                color:white;
            }
        </style>
        <!-- <div class="top-banner">
           
        </div> -->
        <vaadin-dialog></vaadin-dialog>
        <header>
            <div id="tbar">
                <div class="tbar">

                    <div class="container">
                        <vaadin-menu-bar class="cat"></vaadin-menu-bar>
                        <span class="result"> : </span>
                        <input type="text" id="categories" value="{{product.categories}}" disabled
                        placeholder="選擇產品類別">
                    </div>

                    <template id="fans" is="dom-if" if="{{owner.isFanpage}}">
                        <div class="fanpage">
                            <input type="text" id="pages" value="{{owner.username}}" disabled label="專頁"
                            placeholder="不是專頁">
                            <!-- <vaadin-select id="fanPage" placeholder="専頁" value={{product.fanpage}}></vaadin-select> -->
                        </div>
                    </template>
  

                    <vaadin-checkbox-group label="Label" theme="vertical" id="secondlabel">
                        <vaadin-checkbox theme="custom" value="1" id="free" checked={{product.isFree}}>是否免費區
                        </vaadin-checkbox>
                    </vaadin-checkbox-group>

                </div>

                <div class="buttons first">
                    <button id="cancel" on-click="_cancel">取消</button>
                    <button id="save" on-click="_saveData">儲存</button>
                    <button id="publish" on-click="_publish">發佈上架</button>

                </div>
            </div>
        </header>

        <div class="outer">
            <div class="change-new-product-container">
                <div class="left-pics">
                    <!-- 5pics -->

                    <div id="div0" class="bigPic productImg" data-id="0" on-click="_uploadFile" style$="background-image:url({{bigPic}})">

                    </div>
                    <div style="height: 100px;">
                        <!-- GG get Array Pic from Database -->
                        <div class="consmall">
                            <div id="div1" class="productImg" data-id="1" on-click="_uploadFile" style$="background-image:url({{pic1}})"></div>
                            <div id="div2" class="productImg" data-id="2" on-click="_uploadFile" style$="background-image:url({{pic2}})"></div>
                            <div id="div3" class="productImg" data-id="3" on-click="_uploadFile" style$="background-image:url({{pic3}})"></div>
                            <div id="div4" class="productImg" data-id="4" on-click="_uploadFile" style$="background-image:url({{pic4}})"></div>
                        </div>
                        <div class="buttons u">
                            <!-- <button id="upload" on-click="_uploadFile">上載圖片</button> -->
                        </div>
                        <vaadin-dialog></vaadin-dialog>
                    </div>

                    <div>
                        <div class="sellerContact">
                            <b style="font-size: 20px; color: black;">賣家聯絡資料:</b>
                        </div>
                        <!-- TEXT AREA-->
                        <div class="inputbox">
                            <vaadin-text-area id="sContact" name="sellerContact" rows="15" placeholder="填寫你的聯絡資料等等" field="sellerMsg"
                                value="{{product.sellerMsg}}"></vaadin-text-area>
                        </div>
                    </div>
                </div>

                <div class="right-product">
                    <!-- Right Product info -->
                    <div class="fullWidth">
                        <div class="custom-select">
                            <vaadin-select id="vs4" value="全新" style="width: 90px;"></vaadin-select>
                        </div>

                        <div style="width: 100%;">
                            <!--input box-->
                            <div class="inputbox">
                                <vaadin-text-field type="text" id="pname" value="{{product.productname}}" name="firstname"  field="productname"
                                    placeholder="輸入商品標題..."> </vaadin-text-field>
                                <!-- maxlength="14" -->
                            </div>
                        </div>
                    </div>
                    <!-- <change-user-tag id$="{{owner._id}}"></change-user-tag> -->

                    <template id="ownerPanel" is="dom-if" if="{{owner}}">
                        <div class="userinfo">
                            <div id="usericon">
                                <div id="a1">
                                    <img id="gand" src$="{{owner.head}}">
                                    <!-- ./img/user_profile.png -->
                                </div>
                                <div id="a2">
                                    <div class="name" id="owner">{{owner.username}}</div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <div class="hkd" style="display: flex;">
                        <div class="dollar"><b style="font-size: 30px; color: black;">$</b></div>
                        <!--input box-->
                        <div class="inputbox">
                            <vaadin-number-field  id="price" name="priceHKD" placeholder="輸入商品價錢..."  field="price"
                                value={{product.price}}> </vaadin-number-field>
                        </div>
                    </div>
                    <hr>


                    <div class="loca" style="display: flex;">
                        <div id="location"></div>
                        <div style="margin-top: 11px; margin-left: 12px;">
                            <vaadin-select id="vs2" placeholder="選擇地區" value="{{product.district}}"></vaadin-select>
                        </div>
                    </div>



                    <div class="del" style="display: flex;">
                        <div id="delivery"></div>
                        <div style="margin-top: 11px; margin-left: 12px;">
                            <vaadin-select id="vs3" placeholder="選擇發送方法" value="{{product.deliveryMethod}}"></vaadin-select>
                        </div>
                    </div>

                    <hr>



                    <div class="">
                        <div style="margin-top: 20px; margin-bottom: 30px;"><span style="font-size: 20px;">產品描述:</span>
                        </div>
                        <!--typing box-->
                        <div class="inputbox">
                            <vaadin-text-area id="pdes"  field="description" value="{{product.description}}" name="productdescription" rows="12"
                                placeholder="輸入商品描述..."></vaadin-text-area>
                        </div>
                    </div>

                    <div style="display: flex; margin-top: 25px;">
                        <div class="tag">
                            <div><span style="font-size: 20px;"> 標籤： </span></div>
                        </div>

                        <!--Henry version-->
                        <vaadin-text-field id="inputTags" on-keydown="_addTags"></vaadin-text-field>
                        <paper-tags-input width="100%" id="myTags" tags$="{{product.tags}}"></paper-tags-input>

                    </div>
                    <hr>

                    <div>
                        <div style="margin-top: 20px; margin-bottom: 30px;"><span class="bigsize">運輸：</span></div>
                        <!--input box-->
                        <div class="inputbox">
                            <vaadin-text-area  field="deliveryDesc" id="trans" value="{{product.deliveryDesc}}" name="transportation" rows="6"
                                placeholder="輸入物流資料..."></vaadin-text-area>
                        </div>

                    </div>
                    <br>
                </div>

            </div>
        </div>
    `;
  }
}

// Register the element with the browser.
customElements.define('change-add-product', dzElm);

